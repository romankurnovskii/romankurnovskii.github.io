# Глава 35 - virtualenv

Виртуальные среды могут быть очень удобны для тестирования программного обеспечения. Это верно и в кругах программистов. Ян Бикинг создал проект virtualenv, который является инструментом для создания изолированных сред Python. Вы можете использовать эти среды для тестирования новых версий вашего программного обеспечения, новых версий пакетов, от которых вы зависите, или просто в качестве "песочницы" для опробования нового пакета в целом. Вы также можете использовать virtualenv в качестве рабочей среды, когда вы не можете скопировать файлы в пакеты сайта, потому что он находится на общем хосте. Когда вы создаете виртуальную среду с помощью virtualenv, он создает папку и копирует в нее Python вместе с папкой site-packages и несколькими другими. Он также устанавливает pip. Как только ваша виртуальная среда станет активной, вы будете использовать обычный Python. А когда вы закончите, вы можете просто удалить папку для очистки. Никакой суеты, никакой суеты. Кроме того, вы можете продолжать использовать его для разработки.

В этой главе мы потратим некоторое время на знакомство с virtualenv и на то, как использовать его для создания собственной магии.

## Установка

Прежде всего, вам, вероятно, потребуется установить virtualenv. Вы можете использовать pip или easy_install для его установки или скачать файл virtualenv.py с их сайта и установить его из исходников с помощью сценария **setup.py**.

Если у вас Python 3.4, вы обнаружите, что у вас есть модуль **venv**, который использует API, очень похожий на пакет **virtualenv**. Однако в этой главе речь пойдет только о пакете virtualenv.

## Создание виртуальной среды

Создать виртуальную песочницу с помощью пакета virtualenv довольно просто. Все, что вам нужно сделать, это следующее:

```sh
python virtualenv.py FOLDER_NAME
```

Где *FOLDER_NAME** - это имя папки, в которую вы хотите поместить вашу песочницу. На моей машине Windows 7 путь к папке **C:\Python34\Scripts** добавлен, поэтому я могу просто вызвать **virtualenv.py** FOLDER_NAME без части python. Если вы не передадите ему ничего, то получите список опций, выведенный на экран. Допустим, мы создадим проект под названием **sandbox**. Как мы будем его использовать? Ну, нам нужно **активировать** его. Вот как:

В Posix вы сделаете source bin/activate, а в Windows вы сделаете **.\path\to\env\Scripts\activate**. в командной строке. Давайте проделаем эти шаги. Мы создадим папку "песочница" на рабочем столе, чтобы вы могли увидеть пример. Вот как это выглядит на моей машине:

```sh
C:\Users\mdriscoll\Desktop>virtualenv sandbox
New python executable in sandbox\Scripts\python.exe
Installing setuptools................done.
Installing pip...................done.

C:\Users\mdriscoll\Desktop>sandbox\Scripts\activate
(sandbox) C:\Users\mdriscoll\Desktop>
```
Как только ваша виртуальная среда будет активирована, вы увидите, что ваше приглашение изменится и будет включать префикс имени папки, которую вы создали, в данном случае это **sandbox**. Это дает вам знать, что вы используете свою песочницу. Теперь вы можете использовать pip для установки других пакетов в вашу виртуальную среду. Когда вы закончите, просто вызовите сценарий deactivate, чтобы выйти из среды.

Есть несколько флагов, которые вы можете передать virtualenv при создании виртуальной среды, о которых вам следует знать. Например, вы можете использовать **-system-site-packages**, чтобы унаследовать пакеты от пакетов сайта Python по умолчанию. Если вы хотите использовать distribute, а не setuptools, вы можете передать virtualenv флаг **-distribute**.

virtualenv также предоставляет возможность просто установить библиотеки, но использовать для их запуска сам системный Python. Согласно документации, для этого достаточно создать специальный скрипт.

Есть также изящный (и экспериментальный) флаг **-relocatable**, который можно использовать, чтобы сделать папку перемещаемой. Однако на момент написания этой статьи он НЕ работает в Windows, поэтому я не смог его проверить.

Наконец, есть флаг **-extra-search-dir**, который можно использовать для сохранения виртуальной среды в автономном режиме. По сути, он позволяет добавить каталог в путь поиска дистрибутивов, из которых pip или easy_install могут устанавливать. Таким образом, вам не нужно иметь доступ к интернету для установки пакетов.

## Подведение итогов

На данном этапе вы должны уметь использовать virtualenv самостоятельно. На этом этапе стоит упомянуть еще пару проектов. Это библиотека **virtualenvwrapper** Дуга Хеллмана, которая еще больше упрощает создание, удаление и управление виртуальными окружениями, а также **zc.buildout**, который, вероятно, является ближайшим конкурентом virtualenv. Я рекомендую ознакомиться с ними обеими, поскольку они могут помочь вам в ваших приключениях в программировании.
