---
title: 36. Создание модулей и пакетов
description: Python 101
toc: true
authors:
tags:
categories:
series:
featuredImage:
date: "2022-06-28"
lastmod: "2022-06-28"
draft: false
weight: 36
---


Создание модулей Python - это то, что большинство программистов Python делают каждый день, даже не задумываясь об этом. Каждый раз, когда вы сохраняете новый сценарий Python, вы создаете новый модуль. Вы можете импортировать свой модуль в другие модули. Пакет - это коллекция связанных модулей. То, что вы импортируете в свои сценарии из стандартной библиотеки, является модулями или пакетами. В этой главе мы узнаем, как создавать модули и пакеты. Мы уделим больше времени пакетам, поскольку они сложнее модулей.

## Как создать модуль Python

Мы начнем с создания суперпростого модуля. Этот модуль будет предоставлять нам базовую арифметику и не будет обрабатывать ошибки. Вот наш первый пример:

```python
def add(x, y):
    return x + y

def division(x, y):
    return x / y

def multiply(x, y):
    return x * y

def subtract(x, y):
    return x - y
```

У этого кода, конечно, есть проблемы. Отсутствует проверка ошибок при делении на ноль или смешивании строк и чисел. Но дело не в этом. Дело в том, что если вы сохраните этот код, у вас будет полностью квалифицированный модуль. Назовем его **arithmetic.py**. Что можно сделать с модулем? Вы можете импортировать его и использовать любую из определенных функций или классов, которые находятся внутри него. А можно сделать его **исполняемым**, немного подправить и отполировать. Давайте сделаем и то, и другое!

Сначала мы напишем небольшой скрипт, который импортирует наш модуль и запускает функции в нем. Сохраните следующий файл под именем **math_test.py**:

```python
import arithmetic

print(arithmetic.add(5, 8))
print(arithmetic.subtract(10, 5))
print(arithmetic.division(2, 7))
print(arithmetic.multiply(12, 6))
```

Теперь давайте изменим исходный скрипт так, чтобы его можно было запускать из командной строки. Вот один из самых простых способов сделать это:

```python
def add(x, y):
    return x + y

def division(x, y):
    return x / y

def multiply(x, y):
    return x * y

def subtract(x, y):
    return x - y

if __name__ == "__main__":
    import sys
    print(sys.argv)
    v = sys.argv[1].lower()
    valOne = int(sys.argv[2])
    valTwo = int(sys.argv[3])
    if v == "a":
        print(add(valOne, valTwo))
    elif v == "d":
        print(division(valOne, valTwo))
    elif v == "m":
        print(multiply(valOne, valTwo))
    elif v == "s":
        print(subtract(valOne, valTwo))
    else:
        pass
```

Правильным способом выполнения этого сценария было бы использование модуля Python **optparse (pre-2.7)** или **argparse (2.7+)**. Вам следует потратить некоторое время, чтобы разобраться с одним из этих модулей в качестве учебного упражнения. А пока мы перейдем к пакетам!

## Как создать пакет Python

Основное различие между модулем и пакетом заключается в том, что пакет - это набор модулей И у него есть файл **__init__.py**. В зависимости от сложности пакета, он может иметь более одного **__init__.py**. Давайте рассмотрим простую структуру папок, чтобы сделать это более очевидным, а затем создадим простой код, который будет следовать структуре, которую мы определили.

```python
mymath/
    __init__.py
    adv/
        __init__.py
        sqrt.py
    add.py
    subtract.py
    multiply.py
    divide.py
```

Теперь нам просто нужно повторить эту структуру в нашем собственном пакете. Давайте попробуем это сделать! Создайте каждый из этих файлов в дереве папок, как показано в примере выше. Для файлов сложения, вычитания, умножения и деления можно использовать функции, которые мы создали в предыдущем примере. Для модуля **sqrt.py** мы будем использовать следующий код.

```python
# sqrt.py
import math

def squareroot(n):
    return math.sqrt(n)
```

Вы можете оставить оба файла **__init__.py** пустыми, но тогда вам придется писать код типа **mymath.add.add(x,y)**, что довольно некрасиво, поэтому мы добавим следующий код во внешний **__init__.py**, чтобы облегчить понимание и использование нашего пакета.

```python
# outer __init__.py
from . add import add
from . divide import division
from . multiply import multiply
from . subtract import subtract
from .adv.sqrt import squareroot
```

Теперь мы должны иметь возможность использовать наш модуль, когда он находится в пути к Python. Для этого вы можете скопировать папку в папку **site-packages** вашего Python. В Windows она находится в следующем общем месте: **C:\Python34\Lib\site-packages**. В качестве альтернативы вы можете отредактировать путь на лету в коде теста. Давайте посмотрим, как это делается:

```python
import sys

# modify this path to match your environment
sys.path.append('C:\Users\mdriscoll\Documents')

import mymath

print(mymath.add(4,5))
print(mymath.division(4, 2))
print(mymath.multiply(10, 5))
print(mymath.squareroot(48))
```

Обратите внимание, что мой путь НЕ включает папку **mymath**. Вы хотите добавить родительскую папку, в которой находится ваш новый модуль, а не саму папку модуля. Если вы сделаете это, то приведенный выше код будет работать.

Вы также можете создать сценарий **setup.py** и установить ваш пакет в режиме **разработки**. Вот пример скрипта setup.py:

```python
#!/usr/bin/env python

from setuptools import setup


# This setup is suitable for "python setup.py develop".

setup(name='mymath',
      version='0.1',
      description='A silly math package',
      author='Mike Driscoll',
      author_email='mike@mymath.org',
      url='http://www.mymath.org/',
      packages=['mymath', 'mymath.adv'],
      )
```

Сохраните этот сценарий на один уровень выше папки mymath. Чтобы установить пакет в режиме разработки, выполните следующие действия:

```python
python setup.py develop
```
Это установит файл ссылки в папку site-packages, который будет указывать на то место, где находится ваш пакет. Это удобно для тестирования без фактической установки пакета.

Поздравляем! Вы только что создали пакет Python!

## Подведение итогов

Вы только что узнали, как создавать свои собственные модули и пакеты. Вы обнаружите, что чем больше вы пишете, тем чаще вы создаете программы, в которых есть части, которые вы хотите использовать повторно. Эти многократно используемые части кода можно объединить в модули. В конце концов, у вас будет достаточно связанных модулей, и вы захотите объединить их в пакет. Теперь у вас есть инструменты, чтобы сделать это!
