# Глава 24 - Отладчик Python

Python поставляется с собственным модулем отладчика, который называется **pdb**. Этот модуль предоставляет интерактивный отладчик исходного кода для ваших программ на Python. Вы можете устанавливать брейкпоинты, просматривать код, изучать кадры стека и многое другое. Мы рассмотрим следующие аспекты этого модуля:

      -  Как запустить отладчик
      -  Переход по коду
      -  Установка точек останова

Давайте начнем с создания небольшого фрагмента кода, чтобы попробовать отладку. Вот глупый пример:

```sh
# debug_test.py

def doubler(a):
    """"""
    result = a*2
    print(result)
    return result

def main():
    """"""
    for i in range(1,10):
        doubler(i)

if __name__ == "__main__":
    main()
```

Теперь давайте узнаем, как запустить отладчик на этом фрагменте кода.

## Как запустить отладчик

Вы можете запустить отладчик тремя различными способами. Первый - просто импортировать его и вставить **pdb.set_trace()** в свой код, чтобы запустить отладчик. Вы можете импортировать отладчик в IDLE и заставить его запустить ваш модуль. Или можете вызвать отладчик в командной строке. В этом разделе мы сосредоточимся на двух последних методах. Мы начнем с использования отладчика в интерпретаторе (IDLE). Откройте терминал (окно командной строки) и перейдите к месту, где вы сохранили приведенный выше пример кода. Затем запустите Python. Теперь сделайте следующее:


```sh
>>> import debug_test
>>> import pdb
>>> pdb.run('debug_test.main()')
> <string>(1)<module>()
(Pdb) continue
2
4
6
8
10
12
14
16
18
```

Здесь мы импортируем наш модуль и pdb. Затем мы выполняем метод pdb **run** и говорим ему вызвать метод **main** нашего модуля. Это вызывает подсказку отладчика. Здесь мы набрали **continue**, чтобы сказать ему, что нужно продолжить выполнение сценария. Вы также можете набрать букву c в качестве сокращения для continue. При наборе **continue** отладчик продолжит выполнение до тех пор, пока не достигнет точки останова или пока сценарий не завершится.

Другой способ запустить отладчик - выполнить следующую команду в терминале:

```sh
python -m pdb debug_test.py
```

Если вы запустите его таким образом, вы увидите немного другой результат:

```sh
-> def doubler(a):
(Pdb) c
2
4
6
8
10
12
14
16
18
The program finished and will be restarted
```

Вы заметите, что в этом примере мы использовали c вместо **continue**. Вы также заметите, что отладчик перезапускается в конце. Это сохраняет состояние отладчика (например, точки останова) и может быть более полезным, чем остановка отладчика. Иногда вам потребуется просмотреть код несколько раз, чтобы понять, что в нем не так.

Давайте копнем немного глубже и узнаем, как пройтись по коду.

## Пошаговый просмотр кода

Если вы хотите просмотреть код по одной строке за раз, вы можете использовать команду **step** (или просто "s"). Вот сессия для вашего удовольствия:

```sh
C:\Users\mike>cd c:\py101

c:\py101>python -m pdb debug_test.py
> c:\py101\debug_test.py(4)<module>()
-> def doubler(a):
(Pdb) step
> c:\py101\debug_test.py(11)<module>()
-> def main():
(Pdb) s
> c:\py101\debug_test.py(16)<module>()
-> if __name__ == "__main__":
(Pdb) s
> c:\py101\debug_test.py(17)<module>()
-> main()
(Pdb) s
--Call--
> c:\py101\debug_test.py(11)main()
-> def main():
(Pdb) next
> c:\py101\debug_test.py(13)main()
-> for i in range(1,10):
(Pdb) s
> c:\py101\debug_test.py(14)main()
-> doubler(i)
(Pdb)
```

Здесь мы запускаем отладчик и говорим ему, что нужно войти в код. Он начинает сверху и проходит через первые два определения функций. Затем он доходит до условной и обнаруживает, что должен выполнить функцию **main**. Мы переходим в главную функцию, а затем используем команду **next**. Команда **next** выполнит вызываемую функцию, если встретит ее без перехода в нее. Если вы хотите сделать шаг в вызываемую функцию, то достаточно использовать команду **step**.

Когда вы видите строку типа **> c:py101debug_test.py(13)main()**, обратите внимание на число в круглых скобках. Это число - номер текущей строки в коде.

Вы можете использовать команду **args** (или **a**) для вывода текущего списка аргументов на экран. Еще одна удобная команда - **jump** (или **j**), за которой следует пробел и номер строки, на которую вы хотите "перепрыгнуть". Это дает вам возможность пропустить кучу монотонных шагов, чтобы добраться до нужной строки. Это приводит нас к изучению точек останова!

## Настройка точек останова

Точка останова - это строка в коде, где вы хотите приостановить выполнение. Вы можете установить точку останова, вызвав команду **break** (или **b**), за которой следует пробел и номер строки, на которой вы хотите прерваться. Вы также можете дополнить номер строки именем файла и двоеточием, чтобы указать breakpoint в другом файле. Команда break также позволяет установить точку останова с помощью аргумента **function.** Существует также команда **tbreak**, которая устанавливает временную точку останова, которая автоматически удаляется при ее достижении.

Вот пример:

```sh
c:\py101>python -m pdb debug_test.py
> c:\py101\debug_test.py(4)<module>()
-> def doubler(a):
(Pdb) break 6
Breakpoint 1 at c:\py101\debug_test.py:6
(Pdb) c
> c:\py101\debug_test.py(6)doubler()
-> result = a*2
```

Мы запускаем отладчик, а затем говорим ему установить breakpoint на строке 6. Затем мы продолжаем, и он останавливается на строке 6, как и должно быть. Сейчас самое время проверить список аргументов, чтобы убедиться, что он соответствует вашим ожиданиям. Попробуйте это сделать, набрав **args** сейчас. Затем выполните еще одно **continue** и еще один **args**, чтобы посмотреть, как изменился результат.

## Подведение итогов

Существует множество других команд, которые вы можете использовать в отладчике. Я рекомендую прочитать документацию, чтобы узнать о других командах. Однако на данном этапе вы должны уметь эффективно использовать отладчик для отладки собственного кода.
