---
title: 22. Работа с датами и временем
description: Python 101
toc: true
authors:
tags:
categories:
series:
featuredImage:
date: "2022-06-28"
lastmod: "2022-06-28"
draft: false
weight: 22
---

Python предоставляет разработчику несколько инструментов для работы с датами и временем. В этой главе мы рассмотрим модули **datetime** и **time**. Мы изучим, как они работают, и некоторые распространенные способы их использования. Начнем с модуля **datetime**!

## Модуль datetime

Мы познакомимся со следующими классами модуля **datetime**:

    - datetime.date
    - datetime.timedelta
    - datetime.datetime

Они будут охватывать большинство случаев, когда вам понадобится использовать дату и объект datetime в Python. Существует также класс **tzinfo** для работы с часовыми поясами, который мы не будем рассматривать. Не стесняйтесь заглянуть в документацию Python для получения дополнительной информации об этом классе.

## datetime.date

Python может представлять даты несколькими различными способами. Сначала мы рассмотрим формат **datetime.date**, поскольку он является одним из самых простых объектов даты.

```python
>>> datetime.date(2012, 13, 14)
Traceback (most recent call last):
  File "<string>", line 1, in <fragment>
builtins.ValueError: month must be in 1..12
>>> datetime.date(2012, 12, 14)
datetime.date(2012, 12, 14)
```

Этот код показывает, как создать простой объект даты. Класс date принимает три аргумента: год, месяц и день. Если вы передадите ему недопустимое значение, вы увидите ошибку **ValueError**, как показано выше. В противном случае будет возвращен объект **datetime.date**. Давайте рассмотрим другой пример:

```python
>>> import datetime
>>> d = datetime.date(2012, 12, 14)
>>> d.year
2012
>>> d.day
14
>>> d.month
12
```

Здесь мы присваиваем объект date переменной **d**. Теперь мы можем обращаться к различным компонентам даты по имени, например, **d.year** или **d.month**. Теперь давайте узнаем, какой сегодня день:

```python
>>> datetime.date.today()
datetime.date(2014, 3, 5)
```

Это может быть полезно, когда вам нужно записать, какой сегодня день. Или, возможно, вам нужно произвести вычисления на основе сегодняшнего дня. В любом случае, это удобный метод.

## datetime.datetime

Объект **datetime.datetime** содержит всю информацию из datetime.date плюс объект datetime.time. Давайте создадим пару примеров, чтобы лучше понять разницу между этим объектом и объектом datetime.date.

```python
>>> datetime.datetime(2014, 3, 5)
datetime.datetime(2014, 3, 5, 0, 0)
>>> datetime.datetime(2014, 3, 5, 12, 30, 10)
datetime.datetime(2014, 3, 5, 12, 30, 10)
>>> d = datetime.datetime(2014, 3, 5, 12, 30, 10)
>>> d.year
2014
>>> d.second
10
>>> d.hour
12
```

Здесь мы видим, что **datetime.datetime** принимает несколько дополнительных аргументов: год, месяц, день, час, минуту и секунду. Он также позволяет указывать микросекунды и информацию о часовом поясе. При работе с базами данных вы часто будете использовать подобные объекты. Чаще всего вам нужно преобразовать формат даты или времени Python в формат даты или временной метки SQL. Сегодняшний день можно узнать с помощью datetime.datetime, используя два различных метода:

```python
>>> datetime.datetime.today()
datetime.datetime(2014, 3, 5, 17, 56, 10, 737000)
>>> datetime.datetime.now()
datetime.datetime(2014, 3, 5, 17, 56, 15, 418000)
```

В модуле datetime есть еще один метод, о котором вам следует знать, - strftime. Этот метод позволяет разработчику создать строку, которая представляет время в более удобном для восприятия формате. В документации по Python, раздел 8.1.7, есть целая таблица вариантов форматирования, с которой вам следует ознакомиться. Мы рассмотрим пару примеров, чтобы показать вам возможности этого метода:

```python
>>> datetime.datetime.today().strftime("%Y%m%d")
'20140305'
>>> today = datetime.datetime.today()
>>> today.strftime("%m/%d/%Y")
'03/05/2014'
>>> today.strftime("%Y-%m-%d-%H.%M.%S")
'2014-03-05-17.59.53'
```

Первый пример является своего рода хаком. Он показывает, как преобразовать сегодняшний объект datetime в строку, соответствующую формату YYYYMMDD (год, месяц, день). Второй пример лучше. Здесь мы присваиваем сегодняшний объект datetime переменной под названием **today**, а затем пробуем две различные операции форматирования строки. Первая добавляет прямые косые черты между элементами datetime, а также переставляет их так, чтобы получились месяц, день, год. Последний пример создает своеобразную временную метку, которая имеет довольно типичный формат: YYYY-MM-DD.HH.MM.SS. Если вы хотите перейти к двузначному году, вы можете заменить **%Y** на **%y**.

## datetime.timedelta

Объект **datetime.timedelta** представляет длительность времени. Другими словами, это разница между двумя датами или временем. Давайте рассмотрим простой пример:

```python
>>> now = datetime.datetime.now()
>>> now
datetime.datetime(2014, 3, 5, 18, 13, 51, 230000)
>>> then = datetime.datetime(2014, 2, 26)
>>> delta = now - then
>>> type(delta)
<type 'datetime.timedelta'>
>>> delta.days
7
>>> delta.seconds
65631
```

Здесь мы создаем два объекта datetime. Один для сегодняшнего дня, а другой - для недели назад. Затем мы берем разницу между ними. Это возвращает объект timedelta, который мы можем использовать, чтобы узнать количество дней или секунд между двумя датами. Если вам нужно узнать количество часов или минут между двумя датами, вам придется прибегнуть к математическим вычислениям. Вот один из способов сделать это:

```python
>>> seconds = delta.total_seconds()
>>> hours = seconds // 3600
>>> hours
186.0
>>> minutes = (seconds % 3600) // 60
>>> minutes
13.0
```

Это говорит нам о том, что в неделе 186 часов и 13 минут. Обратите внимание, что в качестве оператора деления мы используем двойную прямую косую черту. Это известно как **floor division**.

Теперь мы готовы двигаться дальше и узнать немного о модуле **time**!

## Модуль time

Модуль **time** предоставляет разработчику Python доступ к различным функциям, связанным со временем. Модуль времени основан на так называемой **эпохе** - точке, с которой начинается отсчет времени. Для Unix-систем эпохой является 1970 год. Чтобы узнать, какая эпоха в вашей системе, попробуйте выполнить следующее:

```python
>>> import time
>>> time.gmtime(0)
time.struct_time(tm_year=1970, tm_mon=1, tm_mday=1, tm_hour=0, tm_min=0,
                 tm_sec=0, tm_wday=3, tm_yday=1, tm_isdst=0)
```

Я запустил эту программу на Windows 7, и она тоже считает, что время началось в 1970 году. В любом случае, в этом разделе мы будем изучать следующие функции, связанные со временем:

-  time.ctime
-  time.sleep
-  time.strftime
-  time.time

Давайте начнем!

## time.ctime

Функция **time.ctime** преобразует время в секундах начиная с эпохи в строку, показывающую местное время. Если вы не передадите ей ничего, то будет возвращено текущее время. Давайте опробуем пару примеров:

```python
>>> import time
>>> time.ctime()
'Thu Mar 06 07:28:48 2014'
>>> time.ctime(1384112639)
'Sun Nov 10 13:43:59 2013'
```

Здесь показаны результаты вызова **ctime** , как со случайным набором секунд, начиная с эпохи, так и с пустным значением. Я видел, как подобные вещи используются, когда кто-то сохраняет дату в виде секунд от эпохи, а затем хочет преобразовать ее во что-то понятное человеку. Немного проще, сохранить большое целое число (или длинное) в базу данных, чем страдать над ним, форматируя объект datetime в какой-либо объект даты, который принимает база данных. Конечно, это также имеет свой недостаток: вам, возможно, нужно будет преобразовать целое число или значение с плавающей запятой обратно в строку.

## time.sleep

Функция time.sleep дает разработчику возможность приостановить выполнение вашего сценария на заданное количество секунд. Это как добавление паузы в вашу программу.Я нашел этот класс особенно полезным, когда мне нужно было подождать несколько секунд, пока закроется файл, или база данных закончит выполнять свою задачу. Давайте взглянем на пример. Откройте новое окно в IDLE и сохраните следующий код:

```python
import time

for x in range(5):
    time.sleep(2)
    print("Slept for 2 seconds")
```

Теперь запустите код в IDLE. Это можно сделать, перейдя в меню **Run**, а затем выбрав пункт меню **Run module**. После этого вы увидите, как модуль выведет фразу *Slept for 2 seconds* пять раз с двухсекундной паузой между каждой печатью. Это действительно так просто в использовании!

##time.strftime

Модуль **time** имеет функцию **strftime**, которая работает практически так же, как и версия datetime. Разница в основном в том, что она принимает на вход: кортеж или объект **struct_time**, подобный тем, которые возвращаются при вызове **time.gmtime()** или **time.localtime()**. Вот небольшой пример:

```python
>>> time.strftime("%Y-%m-%d-%H.%M.%S",
                  time.localtime())
'2014-03-06-20.35.56
```

Этот код очень похож на код временной метки, который мы создали в части datetime этой главы. Я думаю, что метод datetime немного более интуитивен, поскольку вы просто создаете объект **datetime.datetime** и затем вызываете его метод **strftime** с нужным вам форматом. В модуле time вам нужно передать формат плюс кортеж времени. Вы сами решаете, какой из этих вариантов наиболее удобен для вас.

## time.time

Функция **time.time** возвращает время в секундах от эпохи в виде числа с плавающей точкой. Давайте посмотрим:

```python
>>> time.time()
1394199262.318
```

Весьма просто. Это можно использовать, когда вы хотите сохранить текущее время в базу данных, но не хотите возиться с преобразованием его в метод datetime базы данных. Вы также можете вспомнить, что метод **ctime** принимает время в секундах, поэтому мы можем использовать **time.time**, чтобы получить количество секунд, которое нужно передать в ctime, вот так:

```python
>>> time.ctime(time.time())
'Fri Mar 07 07:36:38 2014'
```

Если вы немного покопаетесь в документации к модулю времени или просто немного поэкспериментируете с ним, вы, вероятно, найдете еще несколько вариантов использования этой функции.

## Подведение итогов

На данном этапе вы должны знать, как работать с датами и временем с помощью стандартных модулей Python. Python дает вам много возможностей, когда дело доходит до работы с датами. Эти модули пригодятся вам, если вам понадобится создать приложение, которое будет отслеживать назначенные встречи или должно работать в определенные дни. Они также полезны при работе с базами данных.
