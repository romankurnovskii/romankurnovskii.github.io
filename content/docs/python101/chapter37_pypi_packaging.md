# Глава 37 - Как добавить свой код в PyPI

В предыдущей главе мы создали пакет под названием **mymath**. В этой главе мы узнаем, как разместить его на Python Packaging Index (PyPI). Для этого нам сначала нужно узнать, как создать файл **setup.py** Для справки, вот наша текущая иерархия папок:

```sh
mymath/
    __init__.py
    adv/
        __init__.py
        sqrt.py
    add.py
    subtract.py
    multiply.py
    divide.py
```

Это означает, что у вас есть папка **mymath** со следующими файлами в ней: **__init__.py, add.py, subtract.py, multiply.py** и **divide.py**. Внутри папки mymath также есть папка **adv**. В папке adv у вас будет два файла: **__init__.py** и **sqrt.py**.

## Создание файла setup.py

Мы начнем с создания очень простого скрипта **setup.py**. Вот самый простой из них:

```sh
из distutils.core import setup

setup(name='mymath',
      version='0.1',
      packages=['mymath', 'mymath.adv'],
      )
```

Это то, что вы можете написать для внутреннего пакета. Для загрузки в PyPI вам нужно будет указать немного больше информации:

```sh
from distutils.core import setup

setup(name='mymath',
      version='0.1',
      description='A silly math package',
      author='Mike Driscoll',
      author_email='mike@mymath.org',
      url='http://www.mymath.org/',
      packages=['mymath', 'mymath.adv'],
     )
```

Теперь, когда мы закончили с этим, мы должны протестировать наш сценарий. Вы можете создать виртуальную среду, используя указания из главы 35, или просто установить ваш код в вашу установку Python, вызвав следующую команду:

```sh
python setup.py install
```

В качестве альтернативы вы можете использовать метод, описанный в конце прошлой главы, в которой вы создали специальный **setup.py**, который установили в режиме **разработки**. Обратите внимание, что в прошлой главе мы использовали **setuptools**, а в этой - **distutils**. Причина в том, что в setuptools есть команда **develop**, а в distutils - нет.

Теперь нам нужно зарегистрировать наш пакет в PyPI!

## Регистрация пакетов

Зарегистрировать пакет очень просто. Поскольку это ваш первый пакет, вы захотите зарегистрироваться на тестовом сервере PyPI, а не на реальном. Вам может понадобиться создать файл **.pypirc** и ввести адрес сервера Test PyPI. Смотрите следующий раздел для получения дополнительной информации. Как только вы это сделаете, вам просто нужно будет выполнить следующую команду:

```sh
python setup.py register
```

Вы получите список опций, в которых предлагается войти в систему, зарегистрироваться, попросить сервер выслать вам пароль или выйти из системы. Если имя пользователя и пароль сохранены на вашем компьютере, вы не увидите этого сообщения. Если вы уже зарегистрированы, вы можете войти в систему, и метаданные вашего пакета будут загружены.

## Загрузка пакетов в PyPI

Вы, вероятно, захотите начать с тестирования на тестовом сервере PyPI, который находится по адресу https://testpypi.python.org/pypi. Вам придется зарегистрироваться, так как он использует другую базу данных, в отличии от основного сайта. Как только вы это сделаете, вы, возможно, захотите создать файл **.pypirc** где-нибудь в пути вашей операционной системы. В Linux вы можете использовать **$HOME**, чтобы найти его, а в Windows - переменную окружения **HOME**. Этот путь является местом сохранения файла. Ниже приведен пример того, что может быть в файле pypirc с сайта https://wiki.python.org/moin/TestPyPI:

```sh
[distutils]
index-servers=
    pypi
    test

[test]
repository = https://testpypi.python.org/pypi
username = richard
password = <your password goes here>

[pypi]
repository = http://pypi.python.org/pypi
username = richard
password = <your password goes here>

```

Я настоятельно рекомендую вам подробно ознакомиться с документацией, чтобы понять все опции, которые вы можете добавить в этот конфигурационный файл.

Чтобы загрузить некоторые файлы в PyPI, вам нужно будет создать несколько дистрибутивов.

```sh
python setup.py sdist bdist_wininst upload
```

Когда вы выполните приведенную выше команду, она создаст папку **dist**. Команда **sdist** создаст архивный файл (zip в Windows, tarball в Linux). Команда **bdist_wininst** создаст простой исполняемый файл установщика для Windows. Команда upload загрузит эти два файла на PyPI.

В файле **setup.py** вы можете добавить поле **long_description**, которое будет использоваться PyPI для создания домашней страницы вашего пакета на PyPI. Вы можете использовать reStructuredText для форматирования вашего описания. Или вы можете не добавлять описание и принять форматирование PyPI по умолчанию.

Если вам нужен полный список команд, которые вы можете использовать в **setup.py**, попробуйте выполнить следующую команду:

```sh
python setup.py --help-commands
```

Вы также должны добавить файл **README.txt**, который объясняет, как установить и использовать ваш пакет. Он также может содержать раздел "Спасибо", если у вас много вкладчиков.

## Подведение итогов

Теперь вы знаете основы добавления вашего пакета в Python Packaging Index. Если вы хотите добавить Python-яйцо в PyPI, вам нужно будет использовать easy_install вместо distutils. Когда вы выпустите свою следующую версию, вы, возможно, захотите добавить файл **CHANGES.txt**, в котором перечислены изменения в вашем коде. Существует отличный сайт под названием **The Hitchhiker's Guide to Packaging**, на котором вы можете найти дополнительную информацию по этой интересной теме. Кроме того, вы можете ознакомиться с этим [руководством](http://www.scotttorborg.com/python-packaging/index.html) Скотта Торборга, чтобы взглянуть на процесс с другой стороны.
