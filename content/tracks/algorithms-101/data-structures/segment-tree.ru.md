---
title: –î–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤
description: –î–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤
authors:
categories: ['programming', 'Data Structures', '–î–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤', 'Segment Tree']
tags: ['Data Structures']
# series: null
# featuredImage: null
toc: false
weight: 10
date: 2023-02-10
lastmod: 2023-02-10
published: true
prerequisites:
  - –ë–∏–Ω–∞—Ä–Ω–æ–µ –¥–µ—Ä–µ–≤–æ
  - –ü—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ —Å—É–º–º—ã
---

–î–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ç–µ–º—ã "–¥–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤" –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–Ω–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–Ω—è—Ç–∏—è:

- –º–∞—Å—Å–∏–≤—ã
- —Ü–∏–∫–ª—ã
- —É—Å–ª–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- –±–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–î–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤ (Segment Tree) - —ç—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ –∏ –∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –û–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤** (update) –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –∏ **–∑–∞–ø—Ä–æ—Å** (query) –Ω–∞ —Å—É–º–º—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.

**–í—ã–ø–æ–ª–Ω–∏–º —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É:** —É –Ω–∞—Å –µ—Å—Ç—å –º–∞—Å—Å–∏–≤, –∏ –º—ã —Ö–æ—Ç–∏–º –Ω–∞—Ö–æ–¥–∏—Ç—å —Å—É–º–º—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.

–î–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤. –û–Ω–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –∫–∞–∫ **–±–∏–Ω–∞—Ä–Ω–æ–µ –¥–µ—Ä–µ–≤–æ**, –≥–¥–µ –∫–∞–∂–¥—ã–π —É–∑–µ–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∑–ª–∞ - —ç—Ç–æ —Å—É–º–º–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —ç—Ç–æ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ.

**–û—Å–Ω–æ–≤—ã:**

1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—É–º–º—ã –≤ –¥–µ—Ä–µ–≤–µ –æ—Ç—Ä–µ–∑–∫–æ–≤:

–≠–ª–µ–º–µ–Ω—Ç —Å—É–º–º—ã –≤ –¥–µ—Ä–µ–≤–µ –æ—Ç—Ä–µ–∑–∫–æ–≤ —è–≤–ª—è–µ—Ç—Å—è —Å—É–º–º–æ–π –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç.

2. –ö–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –æ—Ç—Ä–µ–∑–∫–æ–≤:

–î–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –±–∞–∑–µ –º–∞—Å—Å–∏–≤–∞ —á–∏—Å–µ–ª. –ö–∞–∂–¥—ã–π —É–∑–µ–ª –¥–µ—Ä–µ–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ –∏ —Ö—Ä–∞–Ω–∏—Ç —Å—É–º–º—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.

3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π:
 
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –¥–µ—Ä–µ–≤–µ –æ—Ç—Ä–µ–∑–∫–æ–≤ –ø–æ —Å—É—Ç–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –û–¥–Ω–∞–∫–æ, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö:

- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤–µ: –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ. –û–±—ã—á–Ω–æ –æ–Ω–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –¥–µ—Ä–µ–≤—É.

- **–ó–∞–ø—Ä–æ—Å –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ**: –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ. –û–±—ã—á–Ω–æ –æ–Ω–∞ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –¥–µ—Ä–µ–≤—É.

- **–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å—É–º–º—É**: –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å—É–º–º—É –∑–Ω–∞—á–µ–Ω–∏–π –≤ –º–∞—Å—Å–∏–≤–µ –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ. –û–Ω–∞ –æ–±—ã—á–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –¥–µ—Ä–µ–≤—É –∏ –ø–æ–¥—Å—á–µ—Ç–∞ —Å—É–º–º—ã

## –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –æ—Ç—Ä–µ–∑–∫–æ–≤

–¢–∞–∫ –∫–∞–∫ –¥–µ—Ä–µ–≤–æ –±–∏–Ω–∞—Ä–Ω–æ–µ, —É –∫–∞–∂–¥–æ–π –≤–µ—Ä—à–∏–Ω—ã –±—É–¥–µ—Ç –¥–æ –¥–≤—É—Ö –ø–æ—Ç–æ–º–∫–æ–≤.

–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º (–¥–ª—è –º–∞—Å—Å–∏–≤–∞ –∏–∑ 8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤):

![segment-tree-structure.ru.png](../assets/segment-tree-structure.ru.png)

–í —Å–∞–º–æ–π –≤–µ—Ä—Ö–Ω–µ–π –≤–µ—Ä—à–∏–Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –æ—Ç—Ä–µ–∑–æ–∫ –æ—Ç –Ω–∞—á–∞–ª–∞ –º–∞—Å—Å–∏–≤–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞.

–°–ª–µ–≤–∞ - –ª–µ–≤–∞ –ø–æ–ª–æ–≤–∏–Ω–∞ –æ—Ç *—Ä–æ–¥–∏—Ç–µ–ª—è* (`[0 1 2 3]`). –°–ø—Ä–∞–≤–∞ - –ø—Ä–∞–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ ()`[4 5 6 7]`). –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–∑–ª–∞ —Å –æ—Ç—Ä–µ–∑–∫–æ–º –∏–∑ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞.

–í–æ–∑—å–º–µ–º –º–∞—Å—Å–∏–≤ `a = [1, 3, -2, 8, -7]`. –ù–∞ –µ–≥–æ –±–∞–∑–µ –ø–æ—Å—Ç—Ä–æ–∏–º –¥–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤–∏ –∑–∞–ø–∏—à–µ–º —Å—É–º–º—ã —ç—Ç–∏—Ö –æ—Ç—Ä–µ–∑–∫–æ–≤ –≤ –∫–∞–∂–¥—ã–π —É–∑–µ–ª.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–∫–æ–≥–æ –¥–µ—Ä–µ–≤–æ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

![segment-tree-sum.ru.png](../assets/segment-tree-sum.ru.png)

üí° –î–µ—Ä–µ–≤–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ–Ω–µ–µ **2n** –≤–µ—Ä—à–∏–Ω. `2*n-1`

–ß–∏—Å–ª–æ –≤–µ—Ä—à–∏–Ω –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è —Å—É–º–º–æ–π $n + \frac{n}{2} + \frac{n}{4} + \frac{n}{8} + \ldots + 1 < 2n$

–û—Ç–æ–±—Ä–∞–∑–∏–º —Ç–∞–∫–æ–µ –¥–µ—Ä–µ–≤–æ –∫–∞–∫ –º–∞—Å—Å–∏–≤:

1. –í —Ç–∞–∫–æ–º –¥–µ—Ä–µ–≤–µ 9 –≤–µ—Ä—à–∏–Ω. –ú–∞—Å—Å–∏–≤ –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 9 —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

```
tree[0] = A[0:4]
tree[1] = A[0:2]
tree[2] = A[3:4]
tree[3] = A[0:1]
tree[4] = A[2:2]
tree[5] = A[3:3]
tree[6] = A[4:4]
tree[7] = A[0:0]
tree[8] = A[1:1]
```

–í –¥–∞–Ω–Ω–æ–º –¥–µ—Ä–µ–≤–µ *–ø–æ–∫—Ä—ã—Ç—ã* –≤—Å–µ –≤–µ—Ä—à–∏–Ω—ã. 

–ò–º–µ—è —Ç–∞–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö –≤–µ—Ä—à–∏–Ω –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—É–º–º—É –æ—Ç—Ä–µ–∑–∫–∞, –Ω–∞–∏–º–µ–Ω—å—à–µ–µ/–Ω–∞–∏–±–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Ç—Ä–µ–∑–∫–∞—Ö.


## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞ –æ—Ç—Ä–µ–∑–∫–æ–≤ –Ω–∞ Python

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ä–µ–≤–∞

`a = [1, 3, -2, 8, -7]`

–¢–∞–∫ –∫–∞–∫ —Å–∞–º—ã–º–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –≤–µ—Ä—à–∏–Ω–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è –æ—Ç—Ä–µ–∑–∫–∏ –¥–ª–∏–Ω–æ–π == `1`. –¢–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—á–∏–Ω–∞–µ–º —Å –Ω–∏—Ö, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ–¥–Ω–∏–º–∞—è—Å—å –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ.

üí° –î–µ—Ä–µ–≤–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ–Ω–µ–µ **2n** –≤–µ—Ä—à–∏–Ω.
üí° –ù–∏–∂–Ω—è—è –≤–∏—Ä—à–∏–Ω–∞ - –¥–ª–∏–Ω–∞ –æ—Ç—Ä–µ–∑–∫–∞ —Ä–∞–≤–Ω–∞ 1.

```python
def build_tree(array):
  n = len(array)
  tree = [0] * 2 * n # –î–µ—Ä–µ–≤–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ–Ω–µ–µ **2n** –≤–µ—Ä—à–∏–Ω.

  for i in range(n):
    tree[n + i] = a[i] # —Å–∞–º—ã–µ –Ω–∏–∂–Ω–∏–µ –≤–µ—Ä—à–∏–Ω—ã –¥–µ—Ä–µ–≤–∞

  # –¥–æ–±–∞–≤–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª–µ–π
  for i in reversed(range(n)):
    tree[i] = tree[2 * i] + tree[2 * i + 1]
    print(i, tree)

>> array = [1, 3, -2, 8, -7]
>> build_tree(array)

  4 [0, 0, 0, 0, 1, 1, 3, -2, 8, -7]
  3 [0, 0, 0, 1, 1, 1, 3, -2, 8, -7]
  2 [0, 0, 2, 1, 1, 1, 3, -2, 8, -7]
  1 [0, 3, 2, 1, 1, 1, 3, -2, 8, -7]
  0 [3, 3, 2, 1, 1, 1, 3, -2, 8, -7]
```

**–ü–æ–¥—Å—á–µ—Ç —Å—É–º–º—ã –Ω–∞ –æ—Ç—Ä–µ–∑–∫–µ:**

–§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞.

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–µ—Ä–µ–≤–∞ –∏–∑ –∏–∑—Ö–æ–¥–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –º—ã –ø–æ–º–µ—â–∞–ª–∏ –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å `[n + i]`.

üí° –ü–æ—ç—Ç–æ–º—É –∫–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–Ω–¥–µ–∫—Å, —Å–Ω–∞—á–∞–ª–∞ –º—ã –Ω–∞–π–¥–µ—Ç *—Å–∞–º—ã–π –Ω–∏–∂–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç* –≤ –¥–µ—Ä–µ–≤–µ. –û–Ω —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ –Ω–æ–≤–æ–º –º–∞—Å—Å–∏–≤–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É `[–¥–ª–∏–Ω–∞_–∏—Å—Ö–æ–¥–Ω–æ–≥–æ_–º–∞—Å—Å–∏–≤–∞ + index]`

```python
# –ø–æ–¥—Å—á–µ—Ç —Å—É–º–º—ã –Ω–∞ –æ—Ç—Ä–µ–∑–∫–µ
def query_tree(l, r):
  global tree, n
  
  sum = 0
  l += n # –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
  r += n
  while l <= r:
      if l % 2 == 1: # –µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –Ω–µ—á–µ—Ç–Ω—ã–π
          sum += tree[l]
          l += 1
      if r % 2 == 0:
          sum += tree[r]
          r -= 1
      l //= 2 # floor division. 8 // 3 = 2
      r //= 2
  return sum

>> a = [1, 3, -2, 8, -7]
>> n = len(a)
>> tree = build_tree(a)

>> query_tree(0, 4) # sum([1, 3, -2, 8, -7])
3
>> query_tree(1, 3) # sum([3, -2, 8])
9
>> query_tree(4, 4)
-7
```

–ü–æ–ª—É—á–∞–µ–º –∫–ª–∞—Å—Å `SegmentTree`:

*–§—É–Ω–∫—Ü–∏—é —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ª—é–±—É—é –¥—Ä—É–≥—É—é –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –≤ –º–æ–º–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–µ—Ä–µ–≤–∞*

```python
class SegmentTree:
    def __init__(self, a):
        self.n = len(a)
        self.tree = [0] * 2 * self.n 
        for i in range(self.n):
            self.tree[self.n + i] = a[i]
        for i in range(self.n - 1, 0, -1):
            self.tree[i] = self.tree[2*i] + self.tree[2*i+1]

    def calculate_sum(self, l, r):
        sum = 0
        l += self.n
        r += self.n
        while l <= r:
            if l % 2 == 1:
                sum += self.tree[l]
                l += 1
            if r % 2 == 0:
                sum += self.tree[r]
                r -= 1
            l //= 2
            r //= 2
        return sum
    
    def find_value(self, l, r):
        l += self.n
        r += self.n
        while l < r:
            if r % 2 == 0:
                r -= 1
            else:
                r -= 1
                l += 1
        return l - self.n
```


## –®–∞–±–ª–æ–Ω –∫–ª–∞—Å—Å–∞ Segment Tree

```python
class SegmentTree:
    def __init__(self, data, default=0, func=max):
        self._default = default
        self._func = func
        self._len = len(data)
        self._size = _size = 1 << (self._len - 1).bit_length()

        self.data = [default] * (2 * _size)
        self.data[_size:_size + self._len] = data
        for i in reversed(range(_size)):
            self.data[i] = func(self.data[i + i], self.data[i + i + 1])

def __delitem__(self, idx):
    self[idx] = self._default

def __getitem__(self, idx):
    return self.data[idx + self._size]

def __setitem__(self, idx, value):
    idx += self._size
    self.data[idx] = value
    idx >>= 1
    while idx:
        self.data[idx] = self._func(self.data[2 * idx], self.data[2 * idx + 1])
        idx >>= 1

def __len__(self):
    return self._len

def query(self, start, stop):
    """func of data[start, stop)"""
    start += self._size
    stop += self._size
    if start==stop:
        return self._default
    res_left = res_right = self._default
    while start < stop:
        if start & 1:
            res_left = self._func(res_left, self.data[start])
            start += 1
        if stop & 1:
            stop -= 1
            res_right = self._func(self.data[stop], res_right)
        start >>= 1
        stop >>= 1

    return self._func(res_left, res_right)

def __repr__(self):
    return "SegmentTree({0})".format(self.data)
```

–ú–µ—Ç–æ–¥ `build_tree` —Å—Ç—Ä–æ–∏—Ç –¥–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤, –∞ `query` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞.

## –†–µ—Å—É—Ä—Å—ã

- https://ru.algorithmica.org/cs/segment-tree/