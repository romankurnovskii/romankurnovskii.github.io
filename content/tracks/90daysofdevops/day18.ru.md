---
title: 18. Web Сервер и SSH
description: Web Сервер и SSH
toc: true
authors:
tags: [devops, linux,  ssh]
categories:
series: 
date: "2022-05-08"
lastMod: "2022-05-08"
featuredImage:
draft: false
id: 1048733
weight: 18
---

## SSH

Как мы уже упоминали, вы, скорее всего, будете управлять множеством удаленных серверов Linux, поэтому вам необходимо убедиться, что ваше подключение к этим удаленным серверам безопасно. В этом разделе мы хотим рассказать о некоторых основах SSH (Secure Shell), которые должен знать каждый, и которые помогут вам с этим безопасным туннелем к вашим удаленным системам.

- Настройка соединения по SSH
- Передача файлов
- Создайте свой закрытый ключ

### Введение в SSH

- Безопасная оболочка (Secure Shell)
- Сетевой протокол (Networking Protocol)
- Обеспечивает безопасную связь
- Может защитить любой сетевой сервис
- Обычно используется для удаленного доступа из командной строки

В нашей среде, если вы следили за нами, мы уже использовали SSH, но все это было настроено и автоматизировано с помощью нашей конфигурации vagrant, поэтому нам нужно было только запустить `vagrant ssh`, и мы получили доступ к нашей удаленной виртуальной машине.

Если бы наша удаленная машина не находилась в той же системе, что и наша рабочая станция, и находилась бы в удаленном месте, возможно, в облачной системе или в центре обработки данных, к которому мы могли бы получить доступ только через Интернет, нам потребовался бы безопасный способ, чтобы получить доступ к системе для управления ею.

SSH обеспечивает безопасный туннель между клиентом и сервером, поэтому злоумышленники ничего не могут перехватить.

![](../images/Day18_Linux1.ru.png?v1)

На сервере есть служба SSH на стороне сервера, которая всегда работает и прослушивает определенный TCP-порт (22).

Если мы используем наш клиент для подключения с правильными учетными данными или ключом SSH, мы получаем доступ к этому серверу.

### Добавление bridged network adapter в нашу систему

Чтобы мы могли использовать SSH с нашей виртуальной машиной, нам нужно добавить сетевой адаптер на нашу машину.

Выключите виртуальную машину, щелкните ее правой кнопкой мыши в Virtual Box и выберите настройки. В новом окне выберите сеть.

![](../images/Day18_Linux2.ru.png?v1)

Теперь снова включите вашу машину, и теперь у вас будет IP-адрес на вашей локальной машине. Вы можете подтвердить это с помощью команды `ip addr`.

### Проверка работы SSH-сервера

Мы знаем, что SSH уже настроен на нашей машине, поскольку мы использовали его с vagrant, но мы можем удостовериться, что сервер бежит, запустив

`sudo systemctl status ssh`

![](../images/Day18_Linux3.ru.png?v1)

Если в вашей системе нет SSH-сервера, вы можете установить его, введя эту команду `sudo apt install openssh-server`

Затем вы хотите убедиться, что наш SSH разрешен и брандмауэр работает. Мы можем сделать это с помощью `sudo ufw allow ssh`. Это не требуется в нашей конфигурации, поскольку мы автоматизировали это с помощью нашего vagrant.

### Удаленный доступ — пароль SSH

Теперь, когда наш SSH-сервер прослушивает порт 22 для любых входящих запросов на подключение, и мы добавили "мост" (bridged networking), мы можем использовать [putty](https://www.ssh.com/academy/ssh/putty/download) или SSH-клиент на нашей локальной машине для подключения к нашей системе с помощью SSH.

![](../images/Day18_Linux4.ru.png?v1)

Затем нажмите «Открыть», если вы впервые подключаетесь к этой системе через этот IP-адрес, вы получите это предупреждение. Мы знаем, что это наша система, поэтому вы можете выбрать «yes».

![](../images/Day18_Linux5.ru.png?v1)

Затем нам будет предложено ввести имя пользователя (vagrant) и пароль (пароль по умолчанию — vagrant). Ниже вы увидите, что теперь мы используем наш SSH-клиент (Putty) для подключения к нашей машине с использованием имени пользователя и пароля.

![](../images/Day18_Linux6.ru.png?v1)

На этом этапе мы подключаемся к нашей виртуальной машине с нашего удаленного клиента и можем выполнять наши команды в нашей системе.

### Удаленный доступ — ключ SSH

Вышеупомянутый простой способ получить доступ к вашим системам, однако, по-прежнему зависит от имени пользователя и пароля, и если какой-либо злоумышленник получит доступ к этой информации, а также к общедоступному адресу или IP-адресу вашей системы, это может быть легко скомпрометировано. Здесь предпочтительны SSH-ключи.

Ключи SSH означают, что мы предоставляем пару ключей, чтобы и клиент, и сервер знали, что это доверенное устройство.

Создать ключ несложно. На нашем локальном компьютере (Windows) мы можем выполнить следующую команду: если у вас установлен ssh-клиент в любой системе, я полагаю, что эта же команда будет работать?

`ssh-keygen -t ed25519`

Я не буду вдаваться в подробности того, что такое ed25519 и что означает здесь, но вы можете воспользоваться поиском, если хотите узнать больше о [криптографии](https://en.wikipedia.org/wiki/EdDSA#Ed25519)

![](../images/Day18_Linux7.ru.png?v1)

На данный момент у нас есть созданный ключ SSH, хранящийся в `C:\Users\micha/.ssh/`

Но чтобы связать это с нашей виртуальной машиной Linux, нам нужно скопировать ключ. Мы можем сделать это, используя `ssh-copy-id vagrant@192.168.169.135`.

Я использовал [PowerShell](https://docs.microsoft.com/ru-ru/powershell/) для создания своих ключей на моем клиенте Windows, но здесь нет доступного `ssh-copy-id`. Есть способы, которыми вы можете сделать это в Windows, и небольшой поиск в Интернете найдет вам альтернативу, но я просто использую git bash на своем компьютере с Windows, чтобы сделать копию.

![](../images/Day18_Linux8.ru.png?v1)

Теперь мы можем вернуться к Powershell, чтобы проверить, что наше соединение теперь работает с нашими ключами SSH, и пароль не требуется.

`ssh vagrant@192.168.169.135`

![](../images/Day18_Linux9.ru.png?v1)

При необходимости мы могли бы защититься, используя кодовую фразу. Мы также могли бы сделать еще один шаг, заявив, что пароли вообще не нужны, что означает, что будут разрешены только пары ключей через SSH. Вы можете сделать это в следующем файле конфигурации.

`sudo nano /etc/ssh/sshd_config`

здесь есть строка с `PasswordAuthentication yes`, она будет закомментирована `#`, вы должны раскомментировать и изменить yes на no. Затем вам нужно будет перезагрузить службу SSH с помощью «sudo systemctl reload sshd».

## Настройка веб-сервера

Не имеет прямого отношения к тому, что мы только что сделали с SSH выше, но я хотел рассмотрть, поскольку это снова еще одна задача, которая может показаться вам немного сложной, но на самом деле этого не должно быть.

У нас есть виртуальная машина с Linux, и на данном этапе мы хотим добавить веб-сервер apache к нашей виртуальной машине, чтобы мы могли разместить на нем простой веб-сайт, который обслуживает мою домашнюю сеть. Обратите внимание, что эта веб-страница не будет доступна из Интернета, это можно сделать, но здесь это не рассматривается.

Вы также можете увидеть, что это называется стеком LAMP.

- **L**inux Operating System
- **A**pache Web Server
- **m**ySQL database
- **P**HP

### Apache2

Apache2 — это HTTP-сервер с открытым исходным кодом. Мы можем установить apache2 с помощью следующей команды.

`sudo apt-get install apache2`

Чтобы убедиться, что apache2 установлен правильно, мы можем запустить `sudo service apache2 restart`.

Затем, используя сетевой адрес моста из пошагового руководства по SSH, откройте браузер и перейдите по этому адресу. Мой `http://192.168.169.135/`

![](../images/Day18_Linux10.ru.png?v1)

### mySQL

MySQL — это база данных, в которой мы будем хранить данные для нашего простого веб-сайта. Чтобы установить MySQL, мы должны использовать следующую команду `sudo apt-get install mysql-server`

### PHP

PHP — это серверный язык (server-side scripting language), мы будем использовать его для взаимодействия с базой данных MySQL. Окончательная установка заключается в установке PHP и зависимостей с помощью sudo apt-get install php libapache2-mod-php php-mysql.

Первое изменение конфигурации, которое мы хотим внести в apache из коробки, — это использование index.html, и вместо этого мы хотим использовать index.php.

Мы будем использовать sudo nano /etc/apache2/mods-enabled/dir.conf и переместим index.php в первый элемент списка.

![](../images/Day18_Linux11.ru.png?v1)

Перезапустите службу apache2 `sudo systemctl restart apache2`

Теперь давайте подтвердим, что наша система правильно настроена для PHP. Создайте следующий файл с помощью этой команды, это откроет пустой файл в nano.

`sudo nano /var/www/html/90Days.php`

затем скопируйте следующее и используйте Ctrl + x, чтобы выйти и сохранить файл.

```
<?php
phpinfo();
?>
```

Теперь снова перейдите к IP-адресу виртуальной машины Linux с дополнительным 90Days.php в конце URL-адреса. `http://192.168.169.135/90Days.php` вы должны увидеть что-то похожее на показанное ниже, если PHP настроен правильно.

![](../images/Day18_Linux12.ru.png?v1)

### Установка WordPress

Я просмотрел тьюториал, чтобы установить WordPress в наш стек LAMP, некоторые команды показаны ниже, если они не показаны правильно в пошаговом руководстве [How to install wordpress on Ubuntu with LAMP](<https://blog.ssdnodes.com/blog/> как установить-wordpress-на-ubuntu-18-04-с-лампой-учебник/)

`sudo mysql -u root -p`

`CREATE DATABASE wordpressdb;`

`CREATE USER 'admin-user'@'localhost' IDENTIFIED BY 'password';`

`GRANT ALL PRIVILEGES ON wordpressdb.* TO 'admin-user'@'localhost';`

`FLUSH PRIVILEGES;`

`EXIT;`

`sudo apt install php-curl php-gd php-mbstring php-xml php-xmlrpc php-soap php-intl php-zip`

`sudo systemctl restart apache2`

`cd /var/www`

`sudo curl -O https://wordpress.org/latest.tar.gz`

`sudo tar -xvf latest.tar.gz`

`sudo rm latest.tar.gz`

На данный момент вы находитесь на шаге 4 в связанной статье, вам нужно будет выполнить шаги, чтобы убедиться, что для каталога WordPress установлены все правильные разрешения.

Поскольку это только внутреннее действие, вам не нужно «генерировать ключи безопасности» на этом шаге. Перейдите к шагу 5, который меняет конфигурацию Apache на WordPress.

Затем, если все настроено правильно, вы сможете получить доступ через свой внутренний сетевой адрес и запустить установку WordPress.

## Ресурсы

- [Client SSH GUI - Remmina](https://remmina.org/)
- [The Beginner's guide to SSH](https://www.youtube.com/watch?v=2QXkrLVsRmk)
- [Vim in 100 Seconds](https://www.youtube.com/watch?v=-txKSRn0qeA)
- [Vim tutorial](https://www.youtube.com/watch?v=IiwGbcd8S7I)
- [Learn the Linux Fundamentals - Part 1](https://www.youtube.com/watch?v=kPylihJRG70)
- [Linux for hackers (don't worry you don't need to be a hacker!)](https://www.youtube.com/watch?v=VbEx7B_PTOE)
