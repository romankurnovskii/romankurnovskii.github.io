---
title: 49. Основы Kubernetes
description: 
toc: true
authors:
tags: [devops]
categories:
series: 
date: "2022-06-08"
lastMod: "2022-06-08"
featuredImage:
draft: false
id: 1049049
weight: 49
---
## Общая картина: Kubernetes

В предыдущем разделе мы рассмотрели контейнеры. Контейнеры не справляются с задачей масштабирования и оркестровки. Лучшее, что мы можем сделать, это использовать docker-compose для объединения нескольких контейнеров. Когда речь заходит о Kubernetes, который является оркестратором контейнеров, это дает нам возможность масштабирования в автоматическом режиме или в зависимости от нагрузки ваших приложений и сервисов.

Как платформа Kubernetes предлагает возможность оркестровки контейнеров в соответствии с вашими требованиями и желаемым состоянием. Мы рассмотрим Kubernetes в этом разделе, поскольку она быстро развивается как следующая волна инфраструктуры. С точки зрения DevOps, Kubernetes - это лишь одна из платформ, базовое понимание которой вам понадобится. Вам также потребуется понимание "голого металла", виртуализации и, скорее всего, облачных сервисов. Kubernetes - это просто еще один вариант запуска наших приложений.

### Что такое оркестровка контейнеров?

Я упомянул Kubernetes и упомянул оркестровку контейнеров, Kubernetes - это технология, а оркестровка контейнеров - это концепция или процесс, стоящий за технологией. Kubernetes - не единственная платформа для оркестровки контейнеров, у нас также есть Docker Swarm, HashiCorp Nomad и другие. Но Kubernetes набирает силу, поэтому я хочу рассказать о Kubernetes, но хочу сказать, что она не единственная.

### Что такое Kubernetes?

Первое, что вам следует прочитать, если вы новичок в Kubernetes, - это официальная документация. Мой опыт глубокого погружения в Kubernetes чуть больше года назад показал, что это будет крутая кривая обучения. Будучи выходцем из сферы виртуализации и хранения данных, я думал о том, насколько пугающим это кажется.

Но на самом деле сообщество, бесплатные учебные ресурсы и документация просто потрясающие. [Kubernetes.io](https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/)

*Kubernetes - это портативная, расширяемая платформа с открытым исходным кодом для управления контейнерными рабочими нагрузками и сервисами, которая облегчает как декларативную конфигурацию, так и автоматизацию. Она имеет большую, быстро развивающуюся экосистему. Услуги, поддержка и инструменты Kubernetes широко доступны*.

Важные моменты, которые следует отметить из вышеприведенного цитаты: Kubernetes является открытым исходным кодом с богатой историей, восходящей к Google, который передал проект в фонд Cloud Native computing Foundation (CNCF), и в настоящее время он развивается сообществом открытого исходного кода, а также крупными корпоративными поставщиками, которые внесли свой вклад, чтобы сделать Kubernetes тем, чем он является сегодня.

Я уже упоминал, что контейнеры - это здорово, и в предыдущем разделе мы говорили о том, как контейнеры и образы контейнеров изменили и ускорили внедрение облачных нативных систем. Но сами по себе контейнеры не дадут вам готового к производству опыта, который необходим вашему приложению. Kubernetes дает нам следующее:

- Обнаружение сервисов и балансировка нагрузки Kubernetes может открыть контейнер, используя DNS-имя или собственный IP-адрес. Если трафик на контейнер высок, Kubernetes может сбалансировать нагрузку и распределить сетевой трафик так, чтобы развертывание было стабильным.

- Оркестровка хранилищ Kubernetes позволяет автоматически монтировать системы хранения по вашему выбору, например, локальные хранилища, общедоступные облачные провайдеры и многое другое.

- Автоматизированное развертывание и откат Вы можете описать желаемое состояние для развернутых контейнеров с помощью Kubernetes, и он может изменить фактическое состояние на желаемое с контролируемой скоростью. Например, вы можете автоматизировать Kubernetes для создания новых контейнеров для развертывания, удаления существующих контейнеров и переноса всех их ресурсов в новый контейнер.

- Автоматическая упаковка контейнеров Вы предоставляете Kubernetes кластер узлов, которые он может использовать для выполнения контейнерных задач. Вы сообщаете Kubernetes, сколько процессора и памяти (RAM) требуется каждому контейнеру. Kubernetes может разместить контейнеры на ваших узлах, чтобы наилучшим образом использовать ваши ресурсы.

- Самовосстановление Kubernetes перезапускает вышедшие из строя контейнеры, заменяет контейнеры, уничтожает контейнеры, которые не отвечают на заданную пользователем проверку работоспособности, и не рекламирует их клиентам, пока они не будут готовы к обслуживанию.

- Управление секретами и конфигурациями Kubernetes позволяет хранить и управлять конфиденциальной информацией, такой как пароли, токены OAuth и ключи SSH. Вы можете развертывать и обновлять секреты и конфигурацию приложений, не перестраивая образы контейнеров и не раскрывая секреты в конфигурации стека.

Kubernetes предоставляет вам основу для отказоустойчивого запуска распределенных систем.

Container Orchestration управляет развертыванием, размещением и жизненным циклом контейнеров.

На нее также возложено множество других обязанностей:

- Управление кластером объединяет узлы в одну цель.

- Управление расписанием распределяет контейнеры по узлам с помощью планировщика.

- Обнаружение сервисов знает, где находятся контейнеры, и распределяет между ними запросы клиентов.

- Репликация обеспечивает наличие необходимого количества узлов и контейнеров для требуемой рабочей нагрузки.

- Управление здоровьем обнаруживает и заменяет нездоровые контейнеры и узлы.

### Основные компоненты Kubernetes

Kubernetes - это контейнерный оркестратор для обеспечения, управления и масштабирования приложений. Вы можете использовать его для управления жизненным циклом контейнерных приложений в кластере узлов, который представляет собой набор рабочих машин, таких как виртуальные машины или физические машины.

Для работы вашим приложениям может понадобиться множество других ресурсов, таких как тома, сети и секреты, которые помогут вам подключаться к базам данных, общаться с бэкграундом и защищать ключи. С помощью Kubernetes вы можете добавить эти ресурсы в свое приложение. Инфраструктурные ресурсы, необходимые вашим приложениям, управляются декларативно.

Ключевой парадигмой Kubernetes является ее декларативная модель. Вы предоставляете нужное вам состояние, а Kubernetes его реализует. Если вам нужно пять экземпляров, вы не запускаете пять отдельных экземпляров самостоятельно. Вместо этого вы сообщаете Kubernetes, что вам нужно пять экземпляров, и Kubernetes автоматически согласовывает состояние. Если с одним из ваших экземпляров что-то пойдет не так и он выйдет из строя, Kubernetes все равно будет знать нужное вам состояние и создаст экземпляры на доступном узле.

### Узел

**План управления**

Каждый кластер Kubernetes требует наличия узла Control Plane, компоненты которого принимают глобальные решения относительно кластера (например, планирование), а также обнаруживают и реагируют на события кластера.

![](../images/Day49_Kubernetes1.ru.png?v1)

**Рабочий узел**
 Рабочая машина, на которой выполняются рабочие нагрузки Kubernetes. Это может быть физическая (bare metal) машина или виртуальная машина (VM). На каждом узле может размещаться один или несколько стручков. Узлы Kubernetes управляются плоскостью управления

![](../images/Day49_Kubernetes2.ru.png?v1)

Существуют и другие типы узлов, но я не буду их здесь рассматривать.

**kubelet**

Агент, который запускается на каждом узле кластера. Он следит за тем, чтобы контейнеры запускались в Pod.

Куплет принимает набор PodSpecs, которые предоставляются через различные механизмы, и гарантирует, что контейнеры, описанные в этих PodSpecs, запущены и здоровы. Куплет не управляет контейнерами, которые не были созданы Kubernetes.

![](../images/Day49_Kubernetes3.ru.png?v1)

**kube-proxy**

kube-proxy - это сетевой прокси, который работает на каждом узле вашего кластера, реализуя часть концепции Kubernetes Service.

kube-proxy поддерживает сетевые правила на узлах. Эти сетевые правила позволяют сетевое взаимодействие с вашими Pods из сетевых сессий внутри или вне вашего кластера.

kube-proxy использует уровень фильтрации пакетов операционной системы, если он есть и доступен. В противном случае kube-proxy сам перенаправляет трафик.

![](../images/Day49_Kubernetes4.ru.png?v1)

**Время выполнения контейнера**

Время выполнения контейнеров - это программное обеспечение, которое отвечает за запуск контейнеров.

Kubernetes поддерживает несколько сред выполнения контейнеров: Docker, containerd, CRI-O и любую реализацию Kubernetes CRI (Container Runtime Interface).

![](../images/Day49_Kubernetes5.ru.png?v1)
​

### Кластер

Кластер - это группа узлов, где узлом может быть физическая машина или виртуальные машины. На каждом из узлов будет установлена среда выполнения контейнеров (Docker), а также будет запущен сервис kubelet, который является агентом, принимающим команды от главного контроллера (подробнее об этом позже), и прокси, который используется для прокси-соединений с Pods от другого компонента (сервисы, которые мы рассмотрим позже).

На нашей плоскости управления, которую можно сделать высокодоступной, будет несколько уникальных ролей по сравнению с рабочими узлами, самой важной из них будет сервер kube API, именно с ним будет происходить любое взаимодействие для получения информации или отправки информации в наш кластер Kubernetes.

**Kube API-Server**

Сервер API Kubernetes проверяет и настраивает данные для объектов api, которые включают стручки, сервисы, контроллеры репликации и другие. API-сервер обслуживает REST-операции и предоставляет фронтенд к общему состоянию кластера, через который взаимодействуют все остальные компоненты.

**Планировщик**

Планировщик Kubernetes - это процесс в плоскости управления, который назначает Pods узлам. Планировщик определяет, какие узлы являются допустимыми для размещения каждого Pod в очереди планирования в соответствии с ограничениями и доступными ресурсами. Затем планировщик ранжирует каждый допустимый узел и привязывает Pod к подходящему узлу.

**Менеджер контроллера**

Менеджер контроллеров Kubernetes - это демон, который встраивает основные контуры управления, поставляемые с Kubernetes. В приложениях робототехники и автоматизации контур управления - это не завершающийся цикл, который регулирует состояние системы. В Kubernetes контроллер - это контур управления, который следит за общим состоянием кластера через apiserver и вносит изменения, пытаясь переместить текущее состояние в желаемое.

**etcd**.

Последовательное и высокодоступное хранилище значений ключей, используемое в качестве резервного хранилища Kubernetes для всех данных кластера.

![](../images/Day49_Kubernetes6.ru.png?v1)

**kubectl**

Для управления этим с точки зрения CLI у нас есть kubectl, kubectl взаимодействует с сервером API.

Инструмент командной строки Kubernetes, kubectl, позволяет выполнять команды для кластеров Kubernetes. Вы можете использовать kubectl для развертывания приложений, проверки и управления ресурсами кластера, а также для просмотра журналов.

![](../images/Day49_Kubernetes7.ru.png?v1)

### Pods

Pod - это группа контейнеров, которые образуют логическое приложение. Например, если у вас есть веб-приложение, в котором запущен контейнер NodeJS, а также контейнер MySQL, то оба этих контейнера будут находиться в одном Pod. Pod также может иметь общие тома данных, а также разделять одно и то же сетевое пространство имен. Помните, что Pods являются эфемерными и могут быть подняты и опущены главным контроллером. Kubernetes использует простое, но эффективное средство идентификации Pods с помощью концепции Labels (имя - значения).

- Подсистемы управляют томами, секретами и конфигурацией контейнеров.

- Подсистемы являются эфемерными. Они предназначены для автоматического перезапуска после смерти.

- Pods реплицируются при горизонтальном масштабировании приложения с помощью ReplicationSet. Каждый Pod будет выполнять один и тот же код контейнера.

- Pods живут на рабочих узлах (Worker Nodes).

![](../images/Day49_Kubernetes8.ru.png?v1)

### Развертывания

- Вы можете просто решить запустить Pods, но когда они умирают, они умирают.

- Развертывание позволит вашему стручку работать непрерывно.

- Развертывания позволяют вам обновлять работающее приложение без простоя.

- Развертывания также определяют стратегию перезапуска стручков, когда они умирают

![](../images/Day49_Kubernetes9.ru.png?v1)

### ReplicaSets

- Развертывание также может создать набор реплик.

- ReplicaSet гарантирует, что ваше приложение имеет необходимое количество Pods.

- ReplicaSets будет создавать и масштабировать Pods на основе развертывания

- Развертывание, наборы реплик, подсистемы не являются исключительными, но могут быть

### StatefulSets

- Требуется ли вашему приложению хранить информацию о его состоянии?

- База данных нуждается в состоянии

- Подсистемы StatefulSet не являются взаимозаменяемыми.

- Каждый Pod имеет уникальный постоянный идентификатор, который контроллер сохраняет при любом перепланировании.

- Каждый Pod имеет уникальный, постоянный идентификатор, который контроллер сохраняет при любом перепланировании.

![](../images/Day49_Kubernetes10.ru.png?v1)

### DaemonSets

- DaemonSets предназначены для непрерывного процесса.

- Они запускают по одному Pod на узел.

- Каждый новый узел, добавленный в кластер, получает запущенный pod.

- Полезны для фоновых задач, таких как мониторинг и сбор логов.

- Каждый Pod имеет уникальный, постоянный идентификатор, который контроллер сохраняет при любом перепланировании.

![](../images/Day49_Kubernetes11.ru.png?v1)

### Сервисы

- единая конечная точка для доступа к Pods

- унифицированный способ маршрутизации трафика к кластеру и, в конечном итоге, к списку Pods.

- Используя сервис, Pods можно поднимать и опускать, не затрагивая ничего.

Это лишь краткий обзор и заметки о фундаментальных строительных блоках Kubernetes, мы можем использовать эти знания и добавить некоторые другие области, такие как Storage и Ingress, чтобы улучшить наши приложения, но у нас также есть большой выбор, где будет работать наш кластер Kubernetes. Следующая сессия будет посвящена этим вариантам, где я могу запустить кластер Kubernetes, а также изучению некоторых особенностей хранения данных.

![](../images/Day49_Kubernetes12.ru.png?v1)

## Ресурсы

- [Kubernetes Documentation](https://kubernetes.io/docs/home/)
- [TechWorld with Nana - Kubernetes Tutorial for Beginners [FULL COURSE in 4 Hours]](https://www.youtube.com/watch?v=X48VuDVv0do)
- [TechWorld with Nana - Kubernetes Crash Course for Absolute Beginners](https://www.youtube.com/watch?v=s_o8dwzRlu4)
- [Kunal Kushwaha - Kubernetes Tutorial for Beginners | What is Kubernetes? Architecture Simplified!](https://www.youtube.com/watch?v=KVBON1lA9N8)
