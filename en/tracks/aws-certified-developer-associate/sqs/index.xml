<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Simple Queue Service on Roman Kurnovskii</title><link>https://romankurnovskii.com/en/tracks/aws-certified-developer-associate/sqs/</link><description>Recent content in Simple Queue Service on Roman Kurnovskii</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>&amp;copy; 2025</copyright><lastBuildDate>Mon, 26 Sep 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://romankurnovskii.com/en/tracks/aws-certified-developer-associate/sqs/index.xml" rel="self" type="application/rss+xml"/><item><title>Fan-Out Orders using Amazon SNS and SQS</title><link>https://romankurnovskii.com/en/tracks/aws-certified-developer-associate/sqs/fan-out-orders-with-sns-sqs/</link><pubDate>Wed, 06 Jul 2022 00:00:00 +0000</pubDate><guid>https://romankurnovskii.com/en/tracks/aws-certified-developer-associate/sqs/fan-out-orders-with-sns-sqs/</guid><description>&lt;h2 id="lab">Lab&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://cloudacademy.com/lab/fan-out-orders-with-sns-sqs/">Fan-Out Orders using Amazon SNS and SQS&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="creating-an-amazon-sns-topic-and-amazon-sqs-queues">Creating an Amazon SNS Topic and Amazon SQS Queues&lt;/h2>
&lt;p>Here&amp;rsquo;s a diagram of what you will build and configure in this lab step:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/sqs-sns-diagram.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol>
&lt;li>In the search bar at the top, enter &lt;em>SNS&lt;/em> and under &lt;strong>Services&lt;/strong>, click the &lt;strong>Simple Notification Service&lt;/strong> result:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220426144130-1-4c7fe27f-244d-4810-b3fd-d902f54522d5.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="2">
&lt;li>In the &lt;strong>Create topic&lt;/strong> card on the right, in the &lt;strong>Topic name&lt;/strong> textbox, enter &lt;em>new-orders&lt;/em> and click &lt;strong>Next step&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-10-11-30-29.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>The &lt;strong>Create topic&lt;/strong> form will load.&lt;/p>
&lt;p>By default, the &lt;strong>Type&lt;/strong> of topic selected will be &lt;strong>Standard&lt;/strong>. This is the most scalable topic type. The cost of this scalability is that message order and exactly-once delivery attempts can not be guaranteed.&lt;/p>
&lt;p>If you are building a solution requires strict message ordering and exactly-once message delivery, you should use a &lt;strong>FIFO&lt;/strong> type topic.&lt;/p>
&lt;p>Standard is fine for this lab.&lt;/p>
&lt;ol start="3">
&lt;li>Click the black triangle next to &lt;strong>Access policy - optional&lt;/strong> to expand the section:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-10-16-46-44.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="4">
&lt;li>In the &lt;strong>Access policy&lt;/strong> section, under &lt;strong>Define who can publish messages to the topic&lt;/strong>, select &lt;strong>Everyone&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-10-16-45-42.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="5">
&lt;li>Under &lt;strong>Define who can subscribe to this topic&lt;/strong>, select &lt;strong>Everyone&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-10-16-49-14.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>You are using a permissive access policy to save time and because the focus of this lab is on demonstrating the fan-out scenario.&lt;/p>
&lt;p>In a non-lab environment, you should carefully consider the access policy required and make sure if conforms with your company or organization&amp;rsquo;s security requirements.&lt;/p>
&lt;ol start="6">
&lt;li>Scroll to the bottom of the page, and click &lt;strong>Create topic&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-07-16-00-00.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>You will see a page load displaying details of your newly created topic:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-07-16-04-56.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>In the order processing system your are building, this Amazon SNS topic is where orders are published to. In a non-lab environment it would most likely be a web application or other application that accepts orders that will publish messages to this topic.&lt;/p>
&lt;p>Next, you will create two queues using Amazon Simple Queue Service and subscribe them to your Amazon SNS topic.&lt;/p>
&lt;ol start="7">
&lt;li>Open a new tab by right-clicking the &lt;strong>AWS&lt;/strong> icon in the top-left and selecting &lt;strong>Open in new tab&lt;/strong>.&lt;/li>
&lt;/ol>
&lt;p>&lt;em>Note&lt;/em>: The above instruction may vary slightly depending upon the web browser you are using.&lt;/p>
&lt;ol start="8">
&lt;li>In the search bar at the top, enter &lt;em>SQS&lt;/em>, and under &lt;strong>Services&lt;/strong>, click the &lt;strong>Simple Queue Service&lt;/strong> result:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220426144410-2-7b2e9397-ec0d-4c43-a3fc-77a09521631a.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="9">
&lt;li>In the middle right of the screen, in the &lt;strong>Get started&lt;/strong> card, click &lt;strong>Create queue&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220426144524-4-a1c1d8c4-cee5-4003-afc8-be7765549203.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>The &lt;strong>Create queue&lt;/strong> form will open.&lt;/p>
&lt;ol start="10">
&lt;li>In the &lt;strong>Name&lt;/strong> textbox, enter &lt;em>orders-for-inventory&lt;/em>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-07-16-23-37.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="11">
&lt;li>Scroll down to the bottom, click &lt;strong>Create queue&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220426144522-3-fce05280-aad4-4c48-b5fd-76c17519d63e.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>You will see a web page load showing you details of your newly created Amazon SQS queue:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-07-16-25-11.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>You will now create a second Amazon SQS queue for analytics.&lt;/p>
&lt;ol start="12">
&lt;li>To navigate to the &lt;strong>Queues&lt;/strong> list page, at the top-left, click &lt;strong>Queues&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-07-16-27-02.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="13">
&lt;li>
&lt;p>On the right-hand side, click &lt;strong>Create queue&lt;/strong>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Repeat the queue creation process, only this time enter &lt;em>orders-for-analytics&lt;/em> as the &lt;strong>Name&lt;/strong> of the queue.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Return to the &lt;strong>Queues&lt;/strong> list page by clicking &lt;strong>Queues&lt;/strong> in the top-left.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>You will see the two queues you have created:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-07-16-31-46.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="16">
&lt;li>
&lt;p>Click the radio button for the &lt;strong>orders-for-analytics&lt;/strong> queue.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>On the right-hand side, click &lt;strong>Actions&lt;/strong> and click &lt;strong>Subscribe to Amazon SNS topic&lt;/strong>:&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220426144713-5-e21eee24-b047-4cbd-8c64-14e86600608f.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>The &lt;strong>Subscribe to Amazon SNS topic&lt;/strong> form will load.&lt;/p>
&lt;ol start="18">
&lt;li>In the &lt;strong>Choose a topic&lt;/strong> drop down, select the topic ending with &lt;strong>new-orders&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/1_creating-sns-topic-and-sqs-queues/assets/2021-05-07-16-34-24.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>This is the Amazon SNS topic you created earlier.&lt;/p>
&lt;ol start="19">
&lt;li>
&lt;p>Click &lt;strong>Save&lt;/strong> to finish subscribing this queue to your topic.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>At the top-left, click &lt;strong>Queues&lt;/strong> again.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Repeat the topic subscription process for your &lt;strong>orders-for-inventory&lt;/strong> Amazon SQS queue.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>You now have both of your Amazon SQS queues subscribed to your Amazon SNS topic. Any messages published to the topic will fan-out to both queues.&lt;/p>
&lt;h2 id="connecting-to-the-virtual-machine-using-ec2-instance-connect">Connecting to the Virtual Machine using EC2 Instance Connect&lt;/h2>
&lt;p>1. In the AWS Management Console search bar, enter &lt;em>EC2&lt;/em>, and click the &lt;strong>EC2&lt;/strong> result under &lt;strong>Services&lt;/strong>:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220222123231-1-d93dcbbf-c7a6-4e7d-9466-d70014660d6b.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>2. To see available instances, click &lt;strong>Instances&lt;/strong> in the left-hand menu:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/blobid1-ae56f48d-6e5e-4414-a899-7a7ee4c156b0.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>The instances list page will open, and you will see an instance named &lt;strong>cloudacademylabs&lt;/strong>:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220208101137-2-36b4b73c-f199-4ce6-b85b-a1bd90ae3819.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>If you don&amp;rsquo;t see a running instance then the lab environment is still loading. Wait until the &lt;strong>Instance state&lt;/strong> is &lt;strong>Running&lt;/strong>.&lt;/p>
&lt;p>3. Right-click the &lt;strong>cloudacademylabs&lt;/strong> instance, and click &lt;strong>Connect&lt;/strong>:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220128094104-2-a2d50c2a-05c8-442c-acc0-4c02dd6c4e38.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>The &lt;strong>Connect to your instance&lt;/strong> form will load.&lt;/p>
&lt;p>4. In the form, ensure the &lt;strong>EC2 Instance Connect&lt;/strong> tab is selected:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-bdf76eab-5bef-415f-bdee-f1ef97330f62.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>You will see the instance&amp;rsquo;s &lt;strong>Instance ID&lt;/strong> and &lt;strong>Public IP address&lt;/strong> displayed.&lt;/p>
&lt;p>5. In the &lt;strong>User name&lt;/strong> textbox, enter &lt;em>ec2-user&lt;/em>:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-ccba4473-690f-4589-9542-7fff1354f72f.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>&lt;em>Note&lt;/em>: Ensure there is no space after ec2-user or connect will fail.&lt;/p>
&lt;p>6. To open a browser-based shell, click &lt;strong>Connect&lt;/strong>:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-f687e238-2010-4e45-b747-763c96e50035.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>If you see an error it&amp;rsquo;s likely that the environment hasn&amp;rsquo;t finished setting up. Check for &lt;strong>Setup completed&lt;/strong> at the top-left corner of the lab and try connecting again:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.labs.cloudacademy.com/content/images/setup/OpenEnvironment.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>A browser-based shell will open in a new window ready for you to use.&lt;/p>
&lt;p>Keep this window open, you will use it in later lab steps.&lt;/p>
&lt;p>You can also connect to the instance using your preferred SSH client and the PPK (Windows) or PEM (Mac/Linux) key files in the &lt;strong>Credentials&lt;/strong> section of this lab.&lt;/p>
&lt;h2 id="publishing-and-processing-messages">Publishing and Processing Messages&lt;/h2>
&lt;ol>
&lt;li>In the terminal, enter the following command:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>aws sns list-topics
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You will see one topic displayed:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/content_engine/image-20220426144936-6-72776ae9-6c41-445c-8b0e-68a652adfc47.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>&lt;em>Note&lt;/em>: Your &lt;strong>TopicArn&lt;/strong> will have a different account identifier.&lt;/p>
&lt;p>By default, the AWS command-line interface tool uses the JSON format for responses. This response contains an array of &lt;strong>Topics&lt;/strong> with one element. The element consists of a &lt;strong>TopicArn&lt;/strong>.&lt;/p>
&lt;p>&lt;strong>Arn&lt;/strong> is short for Amazon Resource Name. An ARN is used to uniquely identify resources in AWS.&lt;/p>
&lt;p>In this lab, the EC2 instance has been configured with an IAM role that has permissions to interact with Amazon SNS topics and Amazon SQS queues.&lt;/p>
&lt;ol start="2">
&lt;li>Store the value of the &lt;strong>TopicArn&lt;/strong> attribute in a shell variable (&lt;code>topic_arn&lt;/code>):&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>topic_arn=$(aws sns list-topics --query &amp;#39;Topics[0].TopicArn&amp;#39; --output text)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The above command uses the &lt;code>--query&lt;/code> option to select only the value of the TopicArn and the &lt;code>--output&lt;/code> option is used to specify plaintext format which removes the quotation marks from the value.&lt;/p>
&lt;ol start="3">
&lt;li>To publish a message, enter the following, utilizing the ARN you stored in the &lt;code>topic_arn&lt;/code> shell variable:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>aws sns publish \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>--topic-arn $topic_arn \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>--message &amp;#34;1 x Widget @ 21.99 USD\n2 x Widget Cables @ 5.99 USD&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In response, you will see a &lt;strong>MessageId&lt;/strong>:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/2_publishing-and-receiving-messages/assets/2021-05-10-15-20-23.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>&lt;em>Note&lt;/em>: Your message identifier will be different.&lt;/p>
&lt;p>You have successfully published an order message to your Amazon Simple Notification Service topic.&lt;/p>
&lt;p>In this lab, you are using the AWS command-line interface tool to simulate an application publishing an order message.&lt;/p>
&lt;p>In a non-lab environment, the message could be published by a web application that accepts orders from customers.&lt;/p>
&lt;ol start="4">
&lt;li>To list Amazon Simple Queue Service queues, enter the following command:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>aws sqs list-queues
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You will see a JSON response:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/2_publishing-and-receiving-messages/assets/2021-05-10-16-10-37.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>The queues that you created earlier are listed.&lt;/p>
&lt;ol start="5">
&lt;li>Store each of the &lt;strong>QueueUrls&lt;/strong> in shell variables:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>analytics_queue_url=$(aws sqs list-queues --query &amp;#39;QueueUrls[0]&amp;#39; --output text)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>inventory_queue_url=$(aws sqs list-queues --query &amp;#39;QueueUrls[1]&amp;#39; --output text)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="6">
&lt;li>To retrieve a message from the &lt;strong>orders-for-analytics&lt;/strong> queue, enter the following command, utilizing the analytics queue URL you stored previously:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>aws sqs receive-message \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --queue-url $analytics_queue_url
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You will see a JSON response containing an array with one &lt;strong>Message&lt;/strong>:&lt;/p>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/2_publishing-and-receiving-messages/assets/2021-05-10-16-58-44.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>The response contains the following fields:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Body&lt;/strong>: A JSON representation of the message&lt;/li>
&lt;li>&lt;strong>ReceiptHandle&lt;/strong>: You are required to supply this to delete a message after processing&lt;/li>
&lt;li>&lt;strong>MD5OfBody&lt;/strong>: An MD5 hash of the message body&lt;/li>
&lt;li>&lt;strong>MessageId&lt;/strong>: The message identifier that Amazon SNS saw when pushing the message to the queues
&lt;ul>
&lt;li>Note that this is not the same as the &lt;strong>MessageId&lt;/strong> that Amazon SNS returned to you when you published to the topic&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;ol start="7">
&lt;li>Repeat the previous instruction, using the &lt;strong>orders-for-inventory&lt;/strong> queue but store the message response in a shell variable (for use later) and output the shell variable (using Python&amp;rsquo;s JSON tool to pretty print it):&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span>inventory_message&lt;span style="color:#666">=$&lt;/span>(aws sqs receive&lt;span style="color:#666">-&lt;/span>message &lt;span style="color:#666">--&lt;/span>queue&lt;span style="color:#666">-&lt;/span>url &lt;span style="color:#666">$&lt;/span>inventory_queue_url)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#666">$&lt;/span>inventory_message &lt;span style="color:#666">|&lt;/span> python &lt;span style="color:#666">-&lt;/span>m json&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#007020;font-weight:bold">tool&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You will see the same message displayed again.&lt;/p>
&lt;p>The message you published to the Amazon SNS topic has been sent to the Amazon SQS queues you subscribed the topic. This is an example of fanning out a message to multiple receivers.&lt;/p>
&lt;p>In a non-lab environment, you could have worker applications constantly running and asking the Amazon SQS queues for more messages. One worker may be updating an inventory database for the order, whilst another worker could be recording the order details in a data lake for future analysis.&lt;/p>
&lt;p>Using Amazon SNS and Amazon SQS like this allows you to build scalable systems that are decoupled and resilient. If a worker went offline, messages would queue up in the Amazon SQS queues. When the worker is available again, it can pick up new messages where it left off.&lt;/p>
&lt;p>You can also have multiple worker applications, to help ensure there&amp;rsquo;s no downtime in message processing.&lt;/p>
&lt;p>After successfully processing a message, a worker application should delete the message to prevent it from being processed again.&lt;/p>
&lt;ol start="8">
&lt;li>Store the value of the &lt;strong>ReceiptHandle&lt;/strong> attribute in a shell variable:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span>receipt_handle&lt;span style="color:#666">=$&lt;/span>(echo &lt;span style="color:#666">$&lt;/span>inventory_message &lt;span style="color:#666">|&lt;/span> python &lt;span style="color:#666">-&lt;/span>m json&lt;span style="color:#666">.&lt;/span>&lt;span style="color:#007020;font-weight:bold">tool&lt;/span> &lt;span style="color:#666">|&lt;/span> grep ReceiptHandle &lt;span style="color:#666">|&lt;/span> cut &lt;span style="color:#666">-&lt;/span>d\&lt;span style="color:#4070a0">&amp;#34; -f 4)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="9">
&lt;li>To delete a message, enter the following command for the &lt;strong>orders-for-inventory&lt;/strong> queue:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>aws sqs delete-message \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --queue-url $inventory_queue_url \
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> --receipt-handle $receipt_handle
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="10">
&lt;li>Return to your browser tab with the Amazon SQS management console open.&lt;/li>
&lt;/ol>
&lt;p>&lt;em>Note&lt;/em>: If the SQS management console appears to only have one SQS queue, click the refresh button above the table:&lt;br>
&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/bakery/media/uploads/blobid1-e8f78050-27a8-4f4e-8238-1ec65fac403b.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;br>
The correct number of SQS queues will be displayed after a refresh.&lt;/p>
&lt;ol start="11">
&lt;li>
&lt;p>Navigate to the &lt;strong>Queues&lt;/strong> list and click the &lt;strong>orders-for-inventory&lt;/strong> queue.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>In the top-right, click &lt;strong>Send and receive messages&lt;/strong>:&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/2_publishing-and-receiving-messages/assets/2021-05-11-12-56-38.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;ol start="13">
&lt;li>Verify that in that &lt;strong>Receive messages&lt;/strong> section, under &lt;strong>Messages available&lt;/strong>, it says &lt;strong>0&lt;/strong>.&lt;/li>
&lt;/ol>
&lt;p>This is the queue you deleted a message for, simulating a long-running background application that receives an Amazon SQS message and then deletes the message after processing.&lt;/p>
&lt;ol start="14">
&lt;li>Repeat the last three instructions for the &lt;strong>orders-for-analytics&lt;/strong> queue and verify &lt;strong>Messages available&lt;/strong> is &lt;strong>1&lt;/strong>:&lt;/li>
&lt;/ol>
&lt;p>&lt;p class="md__image">
&lt;img
src="https://assets.cloudacademy.com/labs/uploads/fan-out-orders-with-sns-sqs//steps/2_publishing-and-receiving-messages/assets/2021-05-11-13-00-29.png"
id="zoom-default"
alt="alt"
loading="lazy"
/>
&lt;/p>
&lt;/p>
&lt;p>This is the queue you did not delete the message for. The message is still available to be picked up for processing by an application receiving messages from the queue.&lt;/p></description></item></channel></rss>