<!doctype html><html lang=ru dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo "><title>21. Модуль потоков Thread | Roman Kurnovskii</title><meta property="og:title" content="21. Модуль потоков Thread | Roman Kurnovskii"><meta property="og:type" content="article"><meta property="og:image" content="https://romankurnovskii.com/images/icon.png"><meta property="og:url" content="https://romankurnovskii.com/ru/tracks/python101/chapter21_thread/"><meta property="og:description" content="Python 101"><meta property="og:locale" content="ru"><meta property="og:site_name" content="Roman Kurnovskii"><meta property="article:published_time" content="2022-06-28T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-11T09:25:30+02:00"><meta property="article:section" content="tracks"><link rel=icon type=image/png sizes=32x32 href=https://romankurnovskii.com/images/icon_huc02d7296c9eb9353758cb2467c0d17b0_10773_32x32_fill_box_center_3.png><link rel=apple-touch-icon sizes=180x180 href=https://romankurnovskii.com/images/icon_huc02d7296c9eb9353758cb2467c0d17b0_10773_180x180_fill_box_center_3.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css rel=stylesheet crossorigin=anonymous><script src=https://unpkg.com/flowbite@1.5.1/dist/flowbite.js></script>
<script src=https://unpkg.com/axios@0.27.2/dist/axios.min.js></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" media=print onload='this.media="all",this.onload=null' crossorigin><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity=" sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" defer crossorigin></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600&display=swap" rel=stylesheet><link rel=stylesheet href=https://romankurnovskii.com/css/yalla.min.c7ec176e8ca18ce892f0d7dd4156de03306c698a683533675776a9c909994c30f4fbe02baed2f6c54ef51f6b8277e88c.css><script defer src=https://romankurnovskii.com/js/yalla.min.c10f88fac8e0f4c2c802131741be30a1f629861cc319c52238e2685191e08f721da37a6696906f314554e1ec7423f51c.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@9.1.3/dist/mermaid.min.js crossorigin></script><meta name=description content="Python 101"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Roadmaps","item":"https://romankurnovskii.com/ru/tracks/"},{"@type":"ListItem","position":2,"name":"Карманная книга по Python","item":"https://romankurnovskii.com/ru/tracks/python101/"},{"@type":"ListItem","position":3,"name":"21. Модуль потоков Thread","item":"https://romankurnovskii.com/ru/tracks/python101/chapter21_thread/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://romankurnovskii.com/ru/tracks/python101/chapter21_thread/"},"headline":"21. Модуль потоков Thread | Roman Kurnovskii","datePublished":"2022-06-28T00:00:00+00:00","dateModified":"2023-02-11T09:25:30+02:00","wordCount":1389,"publisher":{"@type":"Person","name":"Roman Kurnovskii","logo":{"@type":"ImageObject","url":"https://romankurnovskii.com/images/icon.png"}},"description":"Python 101"}</script><link rel=preconnect href=https://www.google-analytics.com crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-26F2C5ZR4Y"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-26F2C5ZR4Y")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js?v2","ym"),ym(87734724,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/87734724 style=position:absolute;left:-9999px alt></div></noscript><script>let storageColorScheme=localStorage.getItem("lightDarkMode");const isDark2=JSON.parse(localStorage.getItem("DarkMode")||"false");isDark2?storageColorScheme="Dark":storageColorScheme="Light",((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script></head><body class="flex min-h-screen flex-col"><header><div class="mx-auto w-full max-w-screen-xl"><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="open mobile menu">
<i class="fas fa-bars"></i></button>
<a href=/ru class="me-6 text-primary-text text-xl font-bold">Roman Kurnovskii</a><div id=mobile-burger-menu class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><ul id=menu><li class=parent><a href=/ru/posts/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Заметки</a><ul class=child><li class=parent><a href=/ru/categories/roadmaps/>Руководства <span class=expand>»</span></a><ul class=child><li class=parent><a href=/ru/tracks/python101/>Справочник Python</a></li><li class=parent><a href=/ru/tracks/webrtc/>Справочник WebRTC</a></li><li class=parent><a href=/ru/tracks/disser/>Диссертация</a></li></ul></li><li class=parent><a href=/ru/categories/programming/>Программирование <span class=expand>»</span></a><ul class=child><li class=parent><a href=/en/tracks/algorithms-101/>Algorithms [EN]</a></li><li class=parent><a href=/ru/categories/hugo/>Hugo</a></li><li class=parent><a href=/ru/categories/javascript/>JavaScript</a></li><li class=parent><a href=/ru/categories/python/>Python</a></li></ul></li><li><a href=/en/p/links/>Links</a></li></ul></li><li class=parent><a href=/ru/apps/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Приложения</a></li><li class=parent><a href=/ru/p/publications class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Публикации</a></li></ul></div><div class=flex><div class="relative pt-4 md:pt-0"><form id=search class="flex items-center"><label for=search-input class=sr-only>Search</label><div class="relative w-full"><input type=text type=search id=search-input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder=Search required></div></form></div><div class="relative pt-4 ps-2 md:pt-0"><button class="p-1 rounded border dark:border-slate-700 hover:bg-slate-200 dark:hover:bg-slate-700" onclick='location.href="/ru/search/"'>
<img width=13 src=https://img.icons8.com/ios-glyphs/30/null/search-more.png></button></div></div></nav></div><div id=is-open-mobile class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0"></div><script>document.addEventListener("DOMContentLoaded",()=>{switchMobileMenuBurger()})</script></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-2xl lg:px-2 xl:px-4"><div class=lg:pt-8><div class="flex flex-col md:flex-row bg-secondary-bg rounded"><div class="md:w-1/4 lg:w-1/5 border-e"><div class="sticky mt-12"><div id=sidebar-title class="md:hidden mx-4 px-2 pt-4 pb-2 md:border-b text-tertiary-text md:text-primary-text"><span class=font-semibold>Содержание</span>
<i class='fas fa-caret-right ms-1'></i></div><div id=sidebar-toc class="hidden md:block mx-6 md:mx-0 pe-2 pt-2 md:max-h-doc-sidebar bg-primary-bg md:bg-transparent"><div class="flex flex-wrap ms-1 -me-2 p-1 bg-secondary-bg md:bg-primary-bg rounded"><a class=hover:text-yalla href=https://romankurnovskii.com/ru/tracks/python101/>Карманная книга по Python</a></div><aside aria-label=Sidebar><div class="py-2 px-1"><ul id=doc__nav__sidebar class=space-y-1><li><a href=https://romankurnovskii.com/ru/tracks/python101/01-intro/><span>Введение</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/01-part_i/><span>Часть I - Основы</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter1_idle/><span>1. Среда разработки</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter2_strings/><span>2. Строки</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter3_lists_dicts/><span>3. Списки, кортежи и словари</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter4_conditionals/><span>4. Условия</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter5_loops/><span>5. Циклы</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter6_comprehensions/><span>6. Генераторы</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter7_exception_handling/><span>7. Обработка исключений</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter8_file_io/><span>8. Работа с файлами</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter9_imports/><span>9. Импорт модулей</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter10_functions/><span>10. Функции</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter11_classes/><span>11. Классы</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter12_introspection/><span>12. Интроспекция</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/02-part_ii/><span>Часть II - Стандартные модули</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter13_csv/><span>13. Модуль csv</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter14_config_parser/><span>14. Модуль configparser</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter15_logging/><span>15. Логирование</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter20_sys/><span>20. Модуль sys</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter16_os/><span>16. Модуль os</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter17_smtplib/><span>17. Модуль email / smtplib</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter18_sqlite/><span>18. Модуль sqlite</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter19_subprocess/><span>19. Модуль subprocess</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter21_thread/ class=bg-tertiary-bg><span>21. Модуль потоков Thread</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter21-1_asyncio/><span>21-1. Модуль asyncio</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter22_time/><span>22. Работа с датами и временем</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter23_xml/><span>23. Модуль xml</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter24_debugging/><span>24. Отладчик Python</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/03-part_iii/><span>Часть III - Промежуточные вопросы и ответы</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter25_decorators/><span>25. Декораторы</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter26_lambda/><span>26. Лямбда</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter27_profiling/><span>27. Профилирование кода</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter28_testing/><span>28. Введение в тестирование</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter29_pip/><span>29. Установка пакетов</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/04-part_iv/><span>Часть IV - Советы, приемы и учебные пособия</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter30_configobj/><span>30. ConfigObj</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter31_lxml/><span>31. Парсинг XML с помощью lxml</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter32_pylint/><span>32. Анализ кода Python</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter33_requests/><span>33. Пакет requests</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter34_sqlalchemy/><span>34. Пакет SQLAlchemy</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter35_virtualenv/><span>35. virtualenv</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter36_creating_modules_and_packages/><span>36. Создание модулей и пакетов</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/05-part_v/><span>Часть V - Упаковка и распространение</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter37_pypi_packaging/><span>37. Как добавить пакет в PyPI</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter38_eggs/><span>38. Python egg</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter39_wheels/><span>39. Python wheels</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter40_py2exe/><span>40. py2exe</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter41_bb_freeze/><span>41. bbfreeze</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter42_cx_freeze/><span>42. cx_Freeze</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter43_pyinstaller/><span>43. PyInstaller</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter44_creating_an_installer/><span>44. Создание программы установки</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/chapter45_hosting/><span>45. Хостинг Python приложения</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/python101/100-plus-voprosov-python/><span>Топ 100 вопросов по Python</span></a></li></ul></div></aside></div></div></div><div class="w-full md:w-3/4 lg:w-4/5 pb-2 pt-2 md:pt-2"><div class=flex><div class="w-full lg:w-3/4 px-6"><article class=prose><h1>21. Модуль потоков Thread</h1><div class="text-tertiary-text text-sm not-prose mt-2 flex flex-row flex-wrap items-center"><div class=me-4><i class="fa-regular fa-calendar-days"></i>
<span>Обновлено: 2023-02-11</span></div><div class=me-4><i class="fa-regular fa-clock"></i>
<span>7 мин</span></div><div id=page__views__div class="me-4 my-2"><i class="fa-regular fa-eye me-1"></i>
<span id=page__views></span></div></div><div class="block lg:hidden"><h3 class=text-lg>Содержание</h3><div class=break-words><nav id=TableOfContents><ul><li><a href=#использование-потоков>Использование потоков</a></li><li><a href=#написание-потокового-загрузчика>Написание потокового загрузчика</a></li><li><a href=#использование-queues>Использование Queues</a></li><li><a href=#подведение-итогов>Подведение итогов</a></li></ul></nav></div></div><p>В Python есть несколько различных конструкций параллелизма, таких как threading, queues и мультипроцессинг. Раньше модуль threading был основным способом реализации multiprocessing. Несколько лет назад в набор стандартных библиотек Python был добавлен модуль multiprocessing. Эта глава будет посвящена использованию потоков и очередей.</p><h2 id=использование-потоков>Использование потоков</h2><p>Мы начнем с простого примера, который просто демонстрирует работу потоков. Мы создадим подкласс класса <strong>Thread</strong> и заставим его выводить свое имя в stdout. Приступим к кодированию!</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>random</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>time</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a></span><span><span style=color:#00a>from</span> <span style=color:#0aa;text-decoration:underline>threading</span> <span style=color:#00a>import</span> Thread
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a></span><span><span style=color:#00a>class</span> <span style=color:#0a0;text-decoration:underline>MyThread</span>(Thread):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a></span><span><span style=color:#a50>    A threading example
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a></span><span><span style=color:#a50>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a></span><span>    <span style=color:#00a>def</span> __init__(self, name):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Initialize the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a></span><span>        Thread.__init__(self)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a></span><span>        self.name = name
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a></span><span>    <span style=color:#00a>def</span> <span style=color:#0a0>run</span>(self):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Run the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a></span><span>        amount = random.randint(<span style=color:#099>3</span>, <span style=color:#099>15</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a></span><span>        time.sleep(amount)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a></span><span>        msg = <span style=color:#a50>&#34;</span><span style=color:#a50>%s</span><span style=color:#a50> is running&#34;</span> % self.name
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a></span><span>        <span style=color:#0aa>print</span>(msg)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a></span><span><span style=color:#00a>def</span> <span style=color:#0a0>create_threads</span>():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a></span><span><span style=color:#a50>    Create a group of threads
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a></span><span><span style=color:#a50>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a></span><span>    <span style=color:#00a>for</span> i <span style=color:#00a>in</span> <span style=color:#0aa>range</span>(<span style=color:#099>5</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a></span><span>        name = <span style=color:#a50>&#34;Thread #</span><span style=color:#a50>%s</span><span style=color:#a50>&#34;</span> % (i+<span style=color:#099>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a></span><span>        my_thread = MyThread(name)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a></span><span>        my_thread.start()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32>32</a></span><span><span style=color:#00a>if</span> __name__ == <span style=color:#a50>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33>33</a></span><span>    create_threads()
</span></span></code></pre></div><p>В приведенном выше коде мы импортируем модуль Python <strong>random</strong>, модуль <strong>time</strong> и импортируем класс <strong>Thread</strong> из модуля <strong>threading</strong>. Далее мы создаем подкласс Thread и переопределяем его метод <strong><strong>init</strong></strong>, чтобы он принимал аргумент, который мы обозначим как name. Чтобы запустить поток, нужно вызвать его метод <strong>start()</strong>. Когда вы запускаете поток, автоматически вызывается метод <strong>run</strong>. Мы переопределили метод <strong>run</strong> потока, чтобы заставить его выбрать случайный промежуток времени для сна. Приведенный здесь пример <strong>random.randint</strong> заставит Python случайным образом выбрать число от 3 до 15. Затем мы заставим поток спать то количество секунд, которое мы только что случайно выбрали, чтобы имитировать, что он действительно что-то делает. Наконец, мы выводим имя потока, чтобы дать пользователю знать, что поток завершен.</p><p>Функция create_threads создаст 5 потоков, присвоив каждому из них уникальное имя. Если вы запустите этот код, вы должны увидеть что-то вроде этого:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a></span><span>Thread <span style=color:#aaa;font-style:italic>#2 is running</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a></span><span>Thread <span style=color:#aaa;font-style:italic>#3 is running</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a></span><span>Thread <span style=color:#aaa;font-style:italic>#1 is running</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4>4</a></span><span>Thread <span style=color:#aaa;font-style:italic>#4 is running</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5>5</a></span><span>Thread <span style=color:#aaa;font-style:italic>#5 is running</span>
</span></span></code></pre></div><p>Порядок вывода будет отличаться каждый раз. Попробуйте выполнить код несколько раз, чтобы увидеть смену порядка. Теперь давайте напишем что-нибудь более практичное!</p><h2 id=написание-потокового-загрузчика>Написание потокового загрузчика</h2><p>Предыдущий пример был не очень полезен, кроме как в качестве инструмента для объяснения работы потоков. Поэтому в этом примере мы создадим класс Thread, который сможет загружать файлы из Интернета. Налоговая служба США имеет множество PDF-форм, которые граждане используют для уплаты налогов. Мы будем использовать этот бесплатный ресурс для нашей демонстрации. Вот код:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>os</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>urllib2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a></span><span><span style=color:#00a>from</span> <span style=color:#0aa;text-decoration:underline>threading</span> <span style=color:#00a>import</span> Thread
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a></span><span><span style=color:#00a>class</span> <span style=color:#0a0;text-decoration:underline>DownloadThread</span>(Thread):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a></span><span><span style=color:#a50>    A threading example that can download a file
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a></span><span><span style=color:#a50>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a></span><span>    <span style=color:#00a>def</span> __init__(self, url, name):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Initialize the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14>14</a></span><span>        Thread.__init__(self)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15>15</a></span><span>        self.name = name
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16>16</a></span><span>        self.url = url
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-17>17</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-18>18</a></span><span>    <span style=color:#00a>def</span> <span style=color:#0a0>run</span>(self):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-19>19</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Run the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-20>20</a></span><span>        handle = urllib2.urlopen(self.url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-21>21</a></span><span>        fname = os.path.basename(self.url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-22>22</a></span><span>        <span style=color:#00a>with</span> <span style=color:#0aa>open</span>(fname, <span style=color:#a50>&#34;wb&#34;</span>) <span style=color:#00a>as</span> f_handler:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-23>23</a></span><span>            <span style=color:#00a>while</span> <span style=color:#00a>True</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-24>24</a></span><span>                chunk = handle.read(<span style=color:#099>1024</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-25>25</a></span><span>                <span style=color:#00a>if</span> <span style=color:#00a>not</span> chunk:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-26>26</a></span><span>                    <span style=color:#00a>break</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-27>27</a></span><span>                f_handler.write(chunk)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-28>28</a></span><span>        msg = <span style=color:#a50>&#34;</span><span style=color:#a50>%s</span><span style=color:#a50> has finished downloading </span><span style=color:#a50>%s</span><span style=color:#a50>!&#34;</span> % (self.name,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-29>29</a></span><span>                                                   self.url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-30>30</a></span><span>        <span style=color:#0aa>print</span>(msg)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-31>31</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-32>32</a></span><span><span style=color:#00a>def</span> <span style=color:#0a0>main</span>(urls):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-33>33</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-34>34</a></span><span><span style=color:#a50>    Run the program
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-35>35</a></span><span><span style=color:#a50>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-36>36</a></span><span>    <span style=color:#00a>for</span> item, url <span style=color:#00a>in</span> <span style=color:#0aa>enumerate</span>(urls):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-37>37</a></span><span>        name = <span style=color:#a50>&#34;Thread </span><span style=color:#a50>%s</span><span style=color:#a50>&#34;</span> % (item+<span style=color:#099>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-38>38</a></span><span>        thread = DownloadThread(url, name)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-39>39</a></span><span>        thread.start()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-40>40</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-41>41</a></span><span><span style=color:#00a>if</span> __name__ == <span style=color:#a50>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-42>42</a></span><span>    urls = [<span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-43>43</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040a.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-44>44</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040ez.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-45>45</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040es.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-46>46</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040sb.pdf&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-47>47</a></span><span>    main(urls)
</span></span></code></pre></div><p>По сути, это полная переработка первого сценария. В нем мы импортируем модули os и urllib2, а также модуль threading. Мы будем использовать urllib2 для выполнения фактической загрузки внутри класса потока. Модуль os используется для извлечения имени загружаемого файла, чтобы мы могли использовать его для создания файла с таким же именем на нашей машине. В классе DownloadThread мы настраиваем <strong>init</strong> для приема url и имени потока. В методе run мы открываем url, извлекаем имя файла и затем используем это имя для именования / создания файла на диске. Затем мы используем цикл <strong>while</strong> для загрузки файла по килобайту за раз и записи его на диск. После завершения сохранения файла мы выводим имя потока и url, который закончил загрузку.</p><p>Версия кода для Python 3 немного отличается. Вы должны импортировать <strong>urllib</strong> вместо <strong>urllib2</strong> и использовать <strong>urllib.request.urlopen</strong> вместо <strong>urllib2.urlopen</strong>. Вот код, чтобы вы могли увидеть разницу:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1> 1</a></span><span><span style=color:#aaa;font-style:italic># Python 3 version</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2> 2</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3> 3</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>os</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4> 4</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>urllib.request</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5> 5</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6> 6</a></span><span><span style=color:#00a>from</span> <span style=color:#0aa;text-decoration:underline>threading</span> <span style=color:#00a>import</span> Thread
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7> 7</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8> 8</a></span><span><span style=color:#00a>class</span> <span style=color:#0a0;text-decoration:underline>DownloadThread</span>(Thread):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-9> 9</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-10>10</a></span><span><span style=color:#a50>    A threading example that can download a file
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-11>11</a></span><span><span style=color:#a50>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-12>12</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-13>13</a></span><span>    <span style=color:#00a>def</span> __init__(self, url, name):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-14>14</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Initialize the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-15>15</a></span><span>        Thread.__init__(self)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-16>16</a></span><span>        self.name = name
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-17>17</a></span><span>        self.url = url
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-18>18</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-19>19</a></span><span>    <span style=color:#00a>def</span> <span style=color:#0a0>run</span>(self):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-20>20</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Run the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-21>21</a></span><span>        handle = urllib.request.urlopen(self.url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-22>22</a></span><span>        fname = os.path.basename(self.url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-23>23</a></span><span>        <span style=color:#00a>with</span> <span style=color:#0aa>open</span>(fname, <span style=color:#a50>&#34;wb&#34;</span>) <span style=color:#00a>as</span> f_handler:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-24>24</a></span><span>            <span style=color:#00a>while</span> <span style=color:#00a>True</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-25>25</a></span><span>                chunk = handle.read(<span style=color:#099>1024</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-26>26</a></span><span>                <span style=color:#00a>if</span> <span style=color:#00a>not</span> chunk:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-27>27</a></span><span>                    <span style=color:#00a>break</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-28>28</a></span><span>                f_handler.write(chunk)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-29>29</a></span><span>        msg = <span style=color:#a50>&#34;</span><span style=color:#a50>%s</span><span style=color:#a50> has finished downloading </span><span style=color:#a50>%s</span><span style=color:#a50>!&#34;</span> % (self.name,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-30>30</a></span><span>                                                   self.url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-31>31</a></span><span>        <span style=color:#0aa>print</span>(msg)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-32>32</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-33>33</a></span><span><span style=color:#00a>def</span> <span style=color:#0a0>main</span>(urls):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-34>34</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-35>35</a></span><span><span style=color:#a50>    Run the program
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-36>36</a></span><span><span style=color:#a50>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-37>37</a></span><span>    <span style=color:#00a>for</span> item, url <span style=color:#00a>in</span> <span style=color:#0aa>enumerate</span>(urls):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-38>38</a></span><span>        name = <span style=color:#a50>&#34;Thread </span><span style=color:#a50>%s</span><span style=color:#a50>&#34;</span> % (item+<span style=color:#099>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-39>39</a></span><span>        thread = DownloadThread(url, name)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-40>40</a></span><span>        thread.start()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-41>41</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-42>42</a></span><span><span style=color:#00a>if</span> __name__ == <span style=color:#a50>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-43>43</a></span><span>    urls = [<span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-44>44</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040a.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-45>45</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040ez.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-46>46</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040es.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-47>47</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040sb.pdf&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-48>48</a></span><span>    main(urls)
</span></span></code></pre></div><h2 id=использование-queues>Использование Queues</h2><p>Очередь(Queues Python) может быть использована для стековых реализаций «пришел первым – ушел первым» (first-in-first-out (FIFO)) или же «пришел последним – ушел последним» (last-in-last-out (LILO)) , если вы используете их правильно. В этом разделе мы смешаем потоки и создадим простой сценарий загрузки файлов, чтобы продемонстрировать, как работают очереди в случаях, когда нам нужен параллелизм.</p><p>Чтобы объяснить, как работают Queues, мы перепишем сценарий загрузки из предыдущего раздела, чтобы использовать Queues. Давайте начнем!</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1> 1</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>os</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2> 2</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>threading</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3> 3</a></span><span><span style=color:#00a>import</span> <span style=color:#0aa;text-decoration:underline>urllib.request</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4> 4</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-5> 5</a></span><span><span style=color:#00a>from</span> <span style=color:#0aa;text-decoration:underline>queue</span> <span style=color:#00a>import</span> Queue
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-6> 6</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-7> 7</a></span><span><span style=color:#00a>class</span> <span style=color:#0a0;text-decoration:underline>Downloader</span>(threading.Thread):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-8> 8</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;Threaded File Downloader&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-9> 9</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-10>10</a></span><span>    <span style=color:#00a>def</span> __init__(self, queue):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-11>11</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Initialize the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-12>12</a></span><span>        threading.Thread.__init__(self)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-13>13</a></span><span>        self.queue = queue
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-14>14</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-15>15</a></span><span>    <span style=color:#00a>def</span> <span style=color:#0a0>run</span>(self):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-16>16</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Run the thread&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-17>17</a></span><span>        <span style=color:#00a>while</span> <span style=color:#00a>True</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-18>18</a></span><span>            <span style=color:#aaa;font-style:italic># gets the url from the queue</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-19>19</a></span><span>            url = self.queue.get()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-20>20</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-21>21</a></span><span>            <span style=color:#aaa;font-style:italic># download the file</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-22>22</a></span><span>            self.download_file(url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-23>23</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-24>24</a></span><span>            <span style=color:#aaa;font-style:italic># send a signal to the queue that the job is done</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-25>25</a></span><span>            self.queue.task_done()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-26>26</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-27>27</a></span><span>    <span style=color:#00a>def</span> <span style=color:#0a0>download_file</span>(self, url):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-28>28</a></span><span>        <span style=color:#a50>&#34;&#34;&#34;Download the file&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-29>29</a></span><span>        handle = urllib.request.urlopen(url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-30>30</a></span><span>        fname = os.path.basename(url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-31>31</a></span><span>        <span style=color:#00a>with</span> <span style=color:#0aa>open</span>(fname, <span style=color:#a50>&#34;wb&#34;</span>) <span style=color:#00a>as</span> f:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-32>32</a></span><span>            <span style=color:#00a>while</span> <span style=color:#00a>True</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-33>33</a></span><span>                chunk = handle.read(<span style=color:#099>1024</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-34>34</a></span><span>                <span style=color:#00a>if</span> <span style=color:#00a>not</span> chunk: <span style=color:#00a>break</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-35>35</a></span><span>                f.write(chunk)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-36>36</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-37>37</a></span><span><span style=color:#00a>def</span> <span style=color:#0a0>main</span>(urls):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-38>38</a></span><span>    <span style=color:#a50>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-39>39</a></span><span><span style=color:#a50>    Run the program
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-40>40</a></span><span><span style=color:#a50>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-41>41</a></span><span>    queue = Queue()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-42>42</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-43>43</a></span><span>    <span style=color:#aaa;font-style:italic># create a thread pool and give them a queue</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-44>44</a></span><span>    <span style=color:#00a>for</span> i <span style=color:#00a>in</span> <span style=color:#0aa>range</span>(<span style=color:#099>5</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-45>45</a></span><span>        t = Downloader(queue)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-46>46</a></span><span>        t.setDaemon(<span style=color:#00a>True</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-47>47</a></span><span>        t.start()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-48>48</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-49>49</a></span><span>    <span style=color:#aaa;font-style:italic># give the queue some data</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-50>50</a></span><span>    <span style=color:#00a>for</span> url <span style=color:#00a>in</span> urls:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-51>51</a></span><span>        queue.put(url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-52>52</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-53>53</a></span><span>    <span style=color:#aaa;font-style:italic># wait for the queue to finish</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-54>54</a></span><span>    queue.join()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-55>55</a></span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-56>56</a></span><span><span style=color:#00a>if</span> __name__ == <span style=color:#a50>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-57>57</a></span><span>    urls = [<span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-58>58</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040a.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-59>59</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040ez.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-60>60</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040es.pdf&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-61>61</a></span><span>            <span style=color:#a50>&#34;http://www.irs.gov/pub/irs-pdf/f1040sb.pdf&#34;</span>]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-62>62</a></span><span>    main(urls)
</span></span></code></pre></div><p>Давайте немного разложим это по полочкам. Прежде всего, нам нужно посмотреть на определение главной функции, чтобы увидеть, как все это работает. Здесь мы видим, что она принимает список url адресов. Затем функция main создает экземпляр очереди, который она передает 5 демонизированным потокам. Основная разница между демонизированным и недемонизированным потоком в том, что вам нужно отслеживать недемонизированные потоки и закрывать их вручную, в то время как поток «демон» нужно только запустить и забыть о нем. Когда ваше приложение закроется, закроется и поток. Далее мы загрузили очередь (при помощи метода put) вместе с переданными url.</p><p>Наконец, мы говорим очереди ждать, пока потоки выполнят свою обработку, используя метод join. В классе загрузки у нас есть строка <strong>self.queue.get()</strong>, которая блокирует очередь до тех пор, пока ей не будет что вернуть. Это означает, что потоки просто сидят без дела, ожидая, пока очередь что-нибудь получит. Это также означает, что для того, чтобы поток мог <strong>получить</strong> что-то из очереди, он должен вызвать метод очереди <strong>get</strong>. Таким образом, по мере добавления или помещения элементов в очередь пул потоков будет забирать или <strong>получать</strong> элементы и обрабатывать их. Это также известно как <strong>dequeing</strong>. Когда все элементы в очереди обработаны, сценарий завершает работу и выходит из программы. На моей машине он загружает все 5 документов менее чем за секунду.</p><h2 id=подведение-итогов>Подведение итогов</h2><p>Теперь вы знаете, как использовать потоки и очереди как в теории, так и на практике. Потоки особенно полезны, когда вы создаете пользовательский интерфейс и хотите сохранить его работоспособность. Без потоков пользовательский интерфейс стал бы неотзывчивым и завис бы во время загрузки большого файла или выполнения большого запроса к базе данных. Чтобы этого не произошло, вы выполняете длительные процессы в потоках, а затем возвращаетесь к интерфейсу, когда закончите.</p></article><div class="-mx-2 mt-4 flex flex-col border-t border-b pb-1 px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">Ранее</span>
<a href=https://romankurnovskii.com/ru/tracks/python101/chapter19_subprocess/ class=block>19. Модуль subprocess</a></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">Далее</span>
<a href=https://romankurnovskii.com/ru/tracks/python101/chapter21-1_asyncio/ class=block>21-1. Модуль asyncio</a></div></div><div id=open_comments_block></div><script src=/opencomments.js renderdivid=open_comments_block server=https://eyt4njm3se.execute-api.eu-west-1.amazonaws.com/comments awstag defer></script></div><div class="hidden lg:block lg:w-1/4"><div class="bg-primary-bg prose sticky top-7 z-10 hidden
px-6 lg:block"><h3 class=text-lg>Содержание</h3></div><div class="sticky-toc hidden px-0 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#использование-потоков>Использование потоков</a></li><li><a href=#написание-потокового-загрузчика>Написание потокового загрузчика</a></li><li><a href=#использование-queues>Использование Queues</a></li><li><a href=#подведение-итогов>Подведение итогов</a></li></ul></nav><div class="feedback-links mt-4 text-sm"><hr><div><a href=https://github.com/romankurnovskii/romankurnovskii.github.io/edit/main/content/tracks/python101/chapter21_thread.ru.md title="Edit this page" target=_blank><i class="fas fa-edit me-1"></i>
<span>Редактировать страницу</span></a></div><div><a href="https://github.com/romankurnovskii/romankurnovskii.github.io/issues/new/?body=File:%20[/content/tracks/python101/chapter21_thread.ru.md/]%28/https:/romankurnovskii.com/ru/tracks/python101/chapter21_thread/%29" title="Request issue" target=_blank><i class="fas fa-check me-1" aria-hidden=true></i>
<span>Запросить изменения</span></a></div></div></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div></div></div></div></div><script>document.addEventListener("DOMContentLoaded",()=>{changeSidebarHeight(),switchDocToc()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2023 <a href=https://romankurnovskii.com>Roman Kurnovskii</a> personal page
&#183;
<a href=https://romankurnovskii.com/ru/index.xml target=_blank>RSS</a> &#183;
<a href=https://gohugo.io>Hugo</a> &#183;
Updated <a href=https://github.com/romankurnovskii/romankurnovskii.github.io/commit/40d4080 target=_blank>2023-02-11</a></p></div><script src=/js/lunr.stemmer.support.min.js></script>
<script src=/js/lunr.ru.min.js></script>
<script src=/js/lunr.multi.min.js></script>
<script src=/js/search.js?v2 languagemode=ru></script><div id=search-result tabindex=-1 class="overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 max-w-xs" hidden><div class="relative p-4 w-full max-w-xs h-full md:h-auto"><div class="relative bg-white rounded-lg shadow dark:bg-gray-700"><div class=p-6><h3>Search results</h3><div id=popup_search_results class=prose></div></div></div></div></div><script src=/js/search-page.js?v3></script>
<script src=/js/base.js?7 languagemode=ru></script></div></footer><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js defer></script>
<script src=/js/zoom-image/placeholders.js?4 defer></script>
<script src=/js/zoom-image/index.js?4 defer></script></body></html>