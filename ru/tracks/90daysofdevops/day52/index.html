<!doctype html><html lang=ru dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo "><title>52. Настройка многоузлового кластера Kubernetes | Roman Kurnovskii</title><meta property="og:title" content="52. Настройка многоузлового кластера Kubernetes | Roman Kurnovskii"><meta property="og:type" content="article"><meta property="og:image" content="https://romankurnovskii.com/images/icon.png"><meta property="og:url" content="https://romankurnovskii.com/ru/tracks/90daysofdevops/day52/"><meta property="og:description" content="Настройка многоузлового кластера Kubernetes Я хотел назвать эту статью &ldquo;Настройка многоузлового кластера Kubernetes с помощью Vagrant&rdquo;, но подумал, что это будет слишком длинно!
На вчерашней сессии мы использовали классный проект для развертывания нашего первого кластера Kubernetes и немного поработали с самым важным инструментом CLI, с которым вы столкнетесь при использовании Kubernetes (kubectl).
Здесь мы будем использовать VirtualBox в качестве основы, но, как мы уже говорили о Vagrant в разделе Linux, мы можем использовать любой гипервизор или инструмент виртуализации."><meta property="og:locale" content="ru"><meta property="og:site_name" content="Roman Kurnovskii"><meta property="article:published_time" content="2022-06-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-11T09:25:30+02:00"><meta property="article:section" content="tracks"><meta property="article:tag" content="devops"><meta property="og:see_also" content="https://romankurnovskii.com/ru/tracks/90daysofdevops/day51/"><meta property="og:see_also" content="https://romankurnovskii.com/ru/tracks/90daysofdevops/day50/"><meta property="og:see_also" content="https://romankurnovskii.com/ru/tracks/90daysofdevops/day49/"><meta property="og:see_also" content="https://romankurnovskii.com/ru/tracks/90daysofdevops/day48/"><meta property="og:see_also" content="https://romankurnovskii.com/ru/tracks/90daysofdevops/day47/"><meta property="og:see_also" content="https://romankurnovskii.com/ru/tracks/90daysofdevops/day46/"><link rel=icon type=image/png sizes=32x32 href=https://romankurnovskii.com/images/icon_huc02d7296c9eb9353758cb2467c0d17b0_10773_32x32_fill_box_center_3.png><link rel=apple-touch-icon sizes=180x180 href=https://romankurnovskii.com/images/icon_huc02d7296c9eb9353758cb2467c0d17b0_10773_180x180_fill_box_center_3.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css rel=stylesheet crossorigin=anonymous><script src=https://unpkg.com/flowbite@1.5.1/dist/flowbite.js></script>
<script src=https://unpkg.com/axios@0.27.2/dist/axios.min.js></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" media=print onload='this.media="all",this.onload=null' crossorigin><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity=" sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" defer crossorigin></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600&display=swap" rel=stylesheet><link rel=stylesheet href=https://romankurnovskii.com/css/yalla.min.7ac4cb22afcb0fe6c9e429a5b2738697db18c27eaba4609849e14253b139ae8b09149afca9dcb4b1f5f738ae28147cb8.css><script defer src=https://romankurnovskii.com/js/yalla.min.c10f88fac8e0f4c2c802131741be30a1f629861cc319c52238e2685191e08f721da37a6696906f314554e1ec7423f51c.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@9.1.3/dist/mermaid.min.js crossorigin></script><meta name=description content="Настройка многоузлового кластера Kubernetes Я хотел назвать эту статью &ldquo;Настройка многоузлового кластера Kubernetes с помощью Vagrant&rdquo;, но подумал, что это будет слишком длинно!
На вчерашней сессии мы использовали классный проект для развертывания нашего первого кластера Kubernetes и немного поработали с самым важным инструментом CLI, с которым вы столкнетесь при использовании Kubernetes (kubectl).
Здесь мы будем использовать VirtualBox в качестве основы, но, как мы уже говорили о Vagrant в разделе Linux, мы можем использовать любой гипервизор или инструмент виртуализации."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Roadmaps","item":"https://romankurnovskii.com/ru/tracks/"},{"@type":"ListItem","position":2,"name":"90 дней DevOps","item":"https://romankurnovskii.com/ru/tracks/90daysofdevops/"},{"@type":"ListItem","position":3,"name":"52. Настройка многоузлового кластера Kubernetes","item":"https://romankurnovskii.com/ru/tracks/90daysofdevops/day52/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://romankurnovskii.com/ru/tracks/90daysofdevops/day52/"},"headline":"52. Настройка многоузлового кластера Kubernetes | Roman Kurnovskii","datePublished":"2022-06-11T00:00:00+00:00","dateModified":"2023-02-11T09:25:30+02:00","wordCount":1325,"publisher":{"@type":"Person","name":"Roman Kurnovskii","logo":{"@type":"ImageObject","url":"https://romankurnovskii.com/images/icon.png"}},"description":"Настройка многоузлового кластера Kubernetes Я хотел назвать эту статью \u0026ldquo;Настройка многоузлового кластера Kubernetes с помощью Vagrant\u0026rdquo;, но подумал, что это будет слишком длинно!\nНа вчерашней сессии мы использовали классный проект для развертывания нашего первого кластера Kubernetes и немного поработали с самым важным инструментом CLI, с которым вы столкнетесь при использовании Kubernetes (kubectl).\nЗдесь мы будем использовать VirtualBox в качестве основы, но, как мы уже говорили о Vagrant в разделе Linux, мы можем использовать любой гипервизор или инструмент виртуализации."}</script><link rel=preconnect href=https://www.google-analytics.com crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-26F2C5ZR4Y"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-26F2C5ZR4Y")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js?v2","ym"),ym(87734724,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/87734724 style=position:absolute;left:-9999px alt></div></noscript><script>let storageColorScheme=localStorage.getItem("lightDarkMode");const isDark2=JSON.parse(localStorage.getItem("DarkMode")||"false");isDark2?storageColorScheme="Dark":storageColorScheme="Light",((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script></head><body class="flex min-h-screen flex-col"><header><div class="mx-auto w-full max-w-screen-xl"><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="open mobile menu">
<i class="fas fa-bars"></i></button>
<a href=/ru class="me-6 text-primary-text text-xl font-bold">Roman Kurnovskii</a><div id=mobile-burger-menu class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><ul id=menu><li class=parent><a href=/ru/posts/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Заметки</a><ul class=child><li class=parent><a href=/ru/categories/roadmaps/>Руководства <span class=expand>»</span></a><ul class=child><li class=parent><a href=/ru/tracks/python-101/>Справочник Python</a></li><li class=parent><a href=/ru/tracks/webrtc/>Справочник WebRTC</a></li><li class=parent><a href=/ru/tracks/disser/>Диссертация</a></li></ul></li><li class=parent><a href=/ru/categories/programming/>Программирование <span class=expand>»</span></a><ul class=child><li class=parent><a href=/en/tracks/algorithms-101/>Algorithms [EN]</a></li><li class=parent><a href=/ru/categories/hugo/>Hugo</a></li><li class=parent><a href=/ru/categories/javascript/>JavaScript</a></li><li class=parent><a href=/ru/categories/python/>Python</a></li></ul></li><li><a href=/en/p/links/>Links</a></li></ul></li><li class=parent><a href=/ru/apps/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Приложения</a></li><li class=parent><a href=/ru/p/publications class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Публикации</a></li></ul></div><div class=flex><div class="relative pt-4 md:pt-0"><form id=search class="flex items-center"><label for=search-input class=sr-only>Search</label><div class="relative w-full"><input type=text type=search id=search-input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder=Search required></div></form></div><div class="relative pt-4 ps-2 md:pt-0"><button class="p-1 rounded border dark:border-slate-700 hover:bg-slate-200 dark:hover:bg-slate-700" onclick='location.href="/ru/search/"'>
<img width=13 src=https://img.icons8.com/ios-glyphs/30/null/search-more.png></button></div></div></nav></div><div id=is-open-mobile class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0"></div><script>document.addEventListener("DOMContentLoaded",()=>{switchMobileMenuBurger()})</script></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-2xl lg:px-2 xl:px-4"><div class=lg:pt-8><div class="flex flex-col md:flex-row bg-secondary-bg rounded"><div class="md:w-1/4 lg:w-1/5 border-e"><div class="sticky mt-12"><div id=sidebar-title class="md:hidden mx-4 px-2 pt-4 pb-2 md:border-b text-tertiary-text md:text-primary-text"><span class=font-semibold>Содержание</span>
<i class='fas fa-caret-right ms-1'></i></div><div id=sidebar-toc class="hidden overflow-y-auto md:block mx-6 md:mx-0 pe-2 pt-2 md:max-h-doc-sidebar bg-primary-bg md:bg-transparent"><div class="flex flex-wrap ms-1 -me-2 p-1 bg-secondary-bg md:bg-primary-bg rounded"><a class=hover:text-yalla href=https://romankurnovskii.com/ru/tracks/90daysofdevops/>90 дней DevOps</a></div><aside aria-label=Sidebar><div class="py-2 px-1"><ul id=doc__nav__sidebar class=space-y-1><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day01/><span>1. DevOps - общее представление</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day02/><span>2. Задачи DevOps-инженера</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day03/><span>3. Ориентированность на приложения</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day04/><span>4. DevOps и Agile</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day05/><span>5. Plan > Code > Build > Testing > Release > Deploy > Operate > Monitor</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day06/><span>6. DevOps - Истории</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day07/><span>7. DevOps - изучение языка программирования</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day08/><span>8. Настройка DevOps окружения для запуска Hello World на Go</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day09/><span>9. Как работает hello-world на Golang</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day10/><span>10. Окружение Go</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day11/><span>11. Переменные и константы в Go</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day12/><span>12. Golang - чтение данных и указатели</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day13/><span>13. Go - подключение Twitter API</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day14/><span>14. DevOps и Linux</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day15/><span>15. Команды Linux в DevOps</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day16/><span>16. Управление системой, файловой системой и хранилищем в Linux</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day17/><span>17. Текстовые редакторы Nano/Vim</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day18/><span>18. Web Сервер и SSH</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day19/><span>19. Автоматизация задачи с помощью bash-скриптов</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day20/><span>20. Настройка рабочей среды DevOps</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day21/><span>21. DevOps настройка сети</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day22/><span>22. Открытая сетевая модель OSI</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day23/><span>23. Протоколы сети</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day24/><span>24. Автоматизация сети</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day25/><span>25. Автоматизация сети с помощью Python</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day26/><span>26. Развертывание виртуальной лаборатории EVE-NG в домашних условиях</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day27/><span>27. Работа с сетью в Python</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day28/><span>28. DevOps в облаке</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day29/><span>29. Знакомство с Microsoft Azure</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day30/><span>30. Модули безопасности Microsoft Azure</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day31/><span>31. Microsoft Azure Среда выполнения приложений</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day32/><span>32. Модели хранилища Microsoft Azure</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day33/><span>33. Сетевые модели Microsoft Azure + Управление Azure</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day34/><span>34. Практические скрипты Microsoft Azure</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day35/><span>35. Git — контроль версий</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day36/><span>36. Установка и настройка Git</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day37/><span>37. Шпаргалка по Git</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day38/><span>38. Staging и Изменения</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day39/><span>39. Просмотр, удаление, отмена и восстановление</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day40/><span>40. GitHub | GitLab | BitBucket</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day41/><span>41. Рабочий процесс с открытым исходным кодом</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day42/><span>42. Контейнеры</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day43/><span>43. Установка Docker</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day44/><span>44. Установка образов Docker в Docker Desktop</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day45/><span>45. Что из себя представляет оьбраз Docker</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day46/><span>46. Docker Compose</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day47/><span>47. Сетевое взаимодействие Docker и безопасность</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day48/><span>48. Альтернативы Docker</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day49/><span>49. Основы Kubernetes</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day50/><span>50. Выбор платформы Kubernetes для проекта</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day51/><span>51. Установка minikube</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day52/ class=bg-tertiary-bg><span>52. Настройка многоузлового кластера Kubernetes</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day53/><span>53. Обзор Rancher</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day54/><span>54. Развертывание приложений Kubernetes</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day55/><span>55. State и Ingress в Kubernetes</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day56/><span>56. Обзор IaC</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day57/><span>57. Введение в Terraform</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day58/><span>58. Язык конфигурации HashiCorp (HCL)</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day59/><span>59. Создание виртуальной машины с помощью Terraform</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day60/><span>60. Контейнеры, провайдеры и модули Docker</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day61/><span>61. Kubernetes и множественные среды</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day62/><span>62. Terraform - Тестирование, инструменты и альтернативы</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day63/><span>63. Инструменты управления конфигурацией - Ansible/Terraform</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day64/><span>64. Ansible Введение</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day65/><span>65. Ansible Playbooks - Часть 1</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day66/><span>66. Ansible Playbooks - Часть 2</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day67/><span>67. Роли и развертывание балансировщика нагрузки</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day68/><span>68. Теги, переменные, инвентаризация и конфигурация сервера базы данных</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day69/><span>69. Ansible - контроллер автоматизации (Tower), AWX, Vault</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day70/><span>70. Конвейеры CI/CD</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day71/><span>71. Введение в Jenkins</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day72/><span>72. Работа с Jenkins</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day73/><span>73. Построение конвейера Jenkins</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day74/><span>74. Hello World - Jenkinsfile App Pipeline</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day75/><span>75. Обзор GitHub Actions</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day76/><span>76. Обзор ArgoCD</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day77/><span>77. Мониторинг</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day78/><span>78. Hands-On Monitoring Tools</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day79/><span>79. Log Management</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day80/><span>80. ELK Stack</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day81/><span>81. Fluentd и FluentBit</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day82/><span>82. EFK Stack</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day83/><span>83. Визуализация данных - Grafana</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day84/><span>84. Управление данными</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day85/><span>85. Службы данных</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day86/><span>86. Резервное копирование всех платформ</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day87/><span>87. Резервное копирование и восстановление</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day88/><span>88. Резервное копирование, ориентированное на приложения</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day89/><span>89. Аварийное восстановление</span></a></li><li><a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day90/><span>90. Мобильность данных и приложений</span></a></li></ul></div></aside></div></div></div><div class="w-full md:w-3/4 lg:w-4/5 pb-2 pt-2 md:pt-2"><div class=flex><div class="w-full lg:w-3/4 px-6"><article class=prose><h1>52. Настройка многоузлового кластера Kubernetes</h1><div class="text-tertiary-text text-sm not-prose mt-2 flex flex-row flex-wrap items-center"><div class=me-4><i class="fa-regular fa-calendar-days"></i>
<span>Обновлено: 2023-02-11</span></div><div class=me-4><i class="fa-regular fa-clock"></i>
<span>7 мин</span></div><div id=page__views__div class="me-4 my-2"><i class="fa-regular fa-eye me-1"></i>
<span id=page__views></span></div></div><div class="block lg:hidden"><h3 class=text-lg>Содержание</h3><div class=break-words><nav id=TableOfContents><ul><li><a href=#настройка-многоузлового-кластера-kubernetes>Настройка многоузлового кластера Kubernetes</a><ul><li><a href=#краткая-информация-о-vagrant>Краткая информация о Vagrant</a></li><li><a href=#лабораторная-среда-kubernetes>Лабораторная среда Kubernetes</a></li><li><a href=#vagrantfile-и-shell-script-walkthrough>Vagrantfile и Shell Script walkthrough</a></li><li><a href=#доступ-к-кластеру-kubernetes>Доступ к кластеру Kubernetes</a></li></ul></li><li><a href=#ресурсы>Ресурсы</a></li></ul></nav></div></div><h2 id=настройка-многоузлового-кластера-kubernetes>Настройка многоузлового кластера Kubernetes</h2><p>Я хотел назвать эту статью &ldquo;Настройка многоузлового кластера Kubernetes с помощью Vagrant&rdquo;, но подумал, что это будет слишком длинно!</p><p>На вчерашней сессии мы использовали классный проект для развертывания нашего первого кластера Kubernetes и немного поработали с самым важным инструментом CLI, с которым вы столкнетесь при использовании Kubernetes (kubectl).</p><p>Здесь мы будем использовать VirtualBox в качестве основы, но, как мы уже говорили о Vagrant в разделе Linux, мы можем использовать любой гипервизор или инструмент виртуализации. Это был <a href=../day14>День 14</a>, когда мы прошли и развернули машину Ubuntu для раздела Linux.</p><h3 id=краткая-информация-о-vagrant>Краткая информация о Vagrant</h3><p>Vagrant - это утилита CLI, которая управляет жизненным циклом ваших виртуальных машин. Мы можем использовать vagrant для запуска и разворачивания виртуальных машин на различных платформах, включая vSphere, Hyper-v, Virtual Box и Docker. У него есть и другие поставщики, но мы будем придерживаться этого, мы используем Virtual Box, так что все готово.</p><p>Я собираюсь использовать базовый уровень этого <a href=https://devopscube.com/kubernetes-cluster-vagrant/>блога и репозитория</a>, чтобы пройтись по конфигурации. Однако я бы посоветовал, если вы впервые развертываете кластер Kubernetes, посмотреть, как это делается вручную, и тогда вы хотя бы будете знать, как это выглядит. Хотя я должен сказать, что эти операции и усилия дня 0 становятся все более эффективными с каждым выпуском Kubernetes. Я сравниваю это с временами VMware и ESX, когда для развертывания 3 серверов ESX требовался по меньшей мере день, а теперь мы можем сделать это за час. Мы движемся в этом направлении, когда речь идет о Kubernetes".</p><h3 id=лабораторная-среда-kubernetes>Лабораторная среда Kubernetes</h3><p>Я загрузил в <a href=../kubernetes>папку Kubernetes</a> vagrantfile, который мы будем использовать для создания нашей среды. Возьмите его и перейдите в этот каталог в терминале. Я снова использую Windows, поэтому я буду использовать PowerShell для выполнения команд рабочей станции с vagrant. Если у вас нет vagrant, вы можете использовать arkade, о котором мы говорили вчера при установке minikube и других инструментов. Простая команда <code>arkade get vagrant</code> должна заставить вас загрузить и установить последнюю версию vagrant.</p><p>Когда вы окажетесь в своей директории, вы можете просто запустить <code>vagrant up</code>, и если все настроено правильно, вы должны увидеть в терминале следующее.</p><p><p class=md__image><img src=../images/Day52_Kubernetes1.png?v1 id=zoom-default alt loading=lazy></p></p><p>В терминале вы увидите ряд шагов, но тем временем давайте посмотрим, что мы на самом деле создаем.</p><p><p class=md__image><img src=../images/Day52_Kubernetes2.png?v1 id=zoom-default alt loading=lazy></p></p><p>Из приведенного выше изображения видно, что мы собираемся создать 3 виртуальные машины, у нас будет узел плоскости управления и два рабочих узла. Если вы вернетесь к <a href=.../day49>День 49</a>, вы увидите более подробное описание этих областей, которые мы видим на изображении.</p><p>Также на изображении мы указываем, что наш доступ к kubectl будет происходить извне кластера и попадать в kube apiserver, в то время как на самом деле в рамках инициализации vagrant мы развертываем kubectl на каждом из этих узлов, чтобы мы могли получить доступ к кластеру изнутри каждого из наших узлов.</p><p>Процесс создания этой лаборатории может занять от 5 до 30 минут в зависимости от вашей установки.</p><p>Я собираюсь в ближайшее время рассказать о скриптах, но если вы посмотрите в файл vagrant, то заметите, что мы вызываем 3 скрипта как часть развертывания, и именно здесь создается кластер. Мы видели, как легко использовать vagrant для развертывания наших виртуальных машин и установки ОС с помощью боксов vagrant, но возможность запуска скрипта оболочки как часть процесса развертывания - это то, что становится довольно интересным в автоматизации этих лабораторных сборок.</p><p>После завершения мы можем подключиться по ssh к одному из наших узлов <code>vagrant ssh master</code> из терминала должен получить доступ, имя пользователя и пароль по умолчанию - <code>vagrant/vagrant</code>.</p><p>Вы также можете использовать <code>vagrant ssh node01</code> и <code>vagrant ssh node02</code> для получения доступа к рабочим узлам, если хотите.</p><p><p class=md__image><img src=../images/Day52_Kubernetes3.png?v1 id=zoom-default alt loading=lazy></p></p><p>Теперь мы находимся на одном из вышеуказанных узлов нашего нового кластера, мы можем выдать команду <code>kubectl get nodes</code>, чтобы показать наш 3-узловой кластер и его статус.</p><p><p class=md__image><img src=../images/Day52_Kubernetes4.png?v1 id=zoom-default alt loading=lazy></p></p><p>На данный момент у нас есть запущенный 3-узловой кластер, с 1 узлом плоскости управления и 2 рабочими узлами.</p><h3 id=vagrantfile-и-shell-script-walkthrough>Vagrantfile и Shell Script walkthrough</h3><p>Если мы посмотрим на наш vagrantfile, вы увидите, что мы определяем количество рабочих узлов, сетевые IP-адреса для мостовой сети в VirtualBox, а также некоторые именования. Еще вы заметите, что мы также вызываем некоторые скрипты, которые мы хотим запустить на определенных хостах.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>NUM_WORKER_NODES=2
</span></span><span style=display:flex><span>IP_NW=&#34;10.0.0.&#34;
</span></span><span style=display:flex><span>IP_START=10
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Vagrant.configure(&#34;2&#34;) do |config|
</span></span><span style=display:flex><span>    config.vm.provision &#34;shell&#34;, inline: &lt;&lt;-SHELL
</span></span><span style=display:flex><span>        apt-get update -y
</span></span><span style=display:flex><span>        echo &#34;$IP_NW$((IP_START))  master-node&#34; &gt;&gt; /etc/hosts
</span></span><span style=display:flex><span>        echo &#34;$IP_NW$((IP_START+1))  worker-node01&#34; &gt;&gt; /etc/hosts
</span></span><span style=display:flex><span>        echo &#34;$IP_NW$((IP_START+2))  worker-node02&#34; &gt;&gt; /etc/hosts
</span></span><span style=display:flex><span>    SHELL
</span></span><span style=display:flex><span>    config.vm.box = &#34;bento/ubuntu-21.10&#34;
</span></span><span style=display:flex><span>    config.vm.box_check_update = true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    config.vm.define &#34;master&#34; do |master|
</span></span><span style=display:flex><span>      master.vm.hostname = &#34;master-node&#34;
</span></span><span style=display:flex><span>      master.vm.network &#34;private_network&#34;, ip: IP_NW + &#34;#{IP_START}&#34;
</span></span><span style=display:flex><span>      master.vm.provider &#34;virtualbox&#34; do |vb|
</span></span><span style=display:flex><span>          vb.memory = 4048
</span></span><span style=display:flex><span>          vb.cpus = 2
</span></span><span style=display:flex><span>          vb.customize [&#34;modifyvm&#34;, :id, &#34;--natdnshostresolver1&#34;, &#34;on&#34;]
</span></span><span style=display:flex><span>      end
</span></span><span style=display:flex><span>      master.vm.provision &#34;shell&#34;, path: &#34;scripts/common.sh&#34;
</span></span><span style=display:flex><span>      master.vm.provision &#34;shell&#34;, path: &#34;scripts/master.sh&#34;
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (1..NUM_WORKER_NODES).each do |i|
</span></span><span style=display:flex><span>      config.vm.define &#34;node0#{i}&#34; do |node|
</span></span><span style=display:flex><span>        node.vm.hostname = &#34;worker-node0#{i}&#34;
</span></span><span style=display:flex><span>        node.vm.network &#34;private_network&#34;, ip: IP_NW + &#34;#{IP_START + i}&#34;
</span></span><span style=display:flex><span>        node.vm.provider &#34;virtualbox&#34; do |vb|
</span></span><span style=display:flex><span>            vb.memory = 2048
</span></span><span style=display:flex><span>            vb.cpus = 1
</span></span><span style=display:flex><span>            vb.customize [&#34;modifyvm&#34;, :id, &#34;--natdnshostresolver1&#34;, &#34;on&#34;]
</span></span><span style=display:flex><span>        end
</span></span><span style=display:flex><span>        node.vm.provision &#34;shell&#34;, path: &#34;scripts/common.sh&#34;
</span></span><span style=display:flex><span>        node.vm.provision &#34;shell&#34;, path: &#34;scripts/node.sh&#34;
</span></span><span style=display:flex><span>      end
</span></span><span style=display:flex><span>    end
</span></span><span style=display:flex><span>  end
</span></span></code></pre></div><p>Давайте разберем эти выполняемые скрипты. У нас есть три скрипта, перечисленные в вышеуказанном VAGRANTFILE для запуска на определенных узлах.</p><p><code>master.vm.provision "shell", path: "scripts/common.sh"</code></p><p>Приведенный выше скрипт будет направлен на подготовку узлов, он будет запущен на всех трех наших узлах и удалит все существующие компоненты Docker и переустановит Docker и ContainerD, а также kubeadm, kubelet и kubectl. Этот скрипт также обновит существующие пакеты программного обеспечения в системе.</p><p><code>master.vm.provision "shell", path: "scripts/master.sh"</code></p><p>Скрипт master.sh будет выполняться только на узле плоскости управления, этот скрипт создаст кластер Kubernetes с помощью команд kubeadm. Он также подготовит контекст конфигурации для доступа к этому кластеру, о чем мы расскажем далее.</p><p><code>node.vm.provision "shell", path: "scripts/node.sh"</code></p><p>Это просто возьмет конфиг, созданный мастером, и присоединит наши узлы к кластеру Kubernetes, этот процесс присоединения снова использует kubeadm и другой скрипт, который можно найти в папке config.</p><h3 id=доступ-к-кластеру-kubernetes>Доступ к кластеру Kubernetes</h3><p>Теперь у нас есть два развернутых кластера: кластер minikube, который мы развернули в предыдущем разделе, и новый 3-узловой кластер, который мы только что развернули на VirtualBox.</p><p>Также в этом конфигурационном файле, к которому у вас будет доступ на машине, с которой вы запускали vagrant, описано, как мы можем получить доступ к нашему кластеру с нашей рабочей станции.</p><p>Прежде чем мы покажем это, позвольте мне коснуться контекста.</p><p><p class=md__image><img src=../images/Day52_Kubernetes5.png?v1 id=zoom-default alt loading=lazy></p></p><p>Контекст важен, необходима возможность доступа к кластеру Kubernetes с рабочего стола или ноутбука. Существует множество различных вариантов, и люди используют различные операционные системы в качестве повседневных драйверов.</p><p>По умолчанию клиент Kubernetes CLI (kubectl) использует папку C:\Users\username.kube\config для хранения информации о кластере Kubernetes, такой как конечная точка и учетные данные. Если вы развернули кластер, вы сможете увидеть этот файл в этом месте. Но если вы до сих пор использовали главный узел для выполнения всех команд kubectl через SSH или другими способами, то эта статья, надеюсь, поможет вам освоить возможность подключения к рабочей станции.</p><p>Затем нам нужно получить файл kubeconfig из кластера или мы также можем получить его из нашего файла конфигурации после развертывания, получить содержимое этого файла либо через SCP, либо просто открыть консольный сеанс на главном узле и скопировать на локальную машину windows.</p><p><p class=md__image><img src=../images/Day52_Kubernetes6.png?v1 id=zoom-default alt loading=lazy></p></p><p>Затем мы хотим взять копию этого файла конфигурации и переместить в место <code>$HOME/.kube/config</code>.</p><p><p class=md__image><img src=../images/Day52_Kubernetes7.png?v1 id=zoom-default alt loading=lazy></p></p><p>Теперь с локальной рабочей станции вы сможете запустить <code>kubectl cluster-info</code> и <code>kubectl get nodes</code>, чтобы убедиться, что у вас есть доступ к вашему кластеру.</p><p><p class=md__image><img src=../images/Day52_Kubernetes8.png?v1 id=zoom-default alt loading=lazy></p></p><p>Это не только обеспечивает подключение и управление с вашей windows-машины, но и позволяет нам выполнить проброс портов для доступа к определенным сервисам с нашей windows-машины.</p><p>Если вам интересно, как управлять несколькими кластерами на рабочей станции, у меня есть более подробное описание <a href=https://vzilla.co.uk/vzilla-blog/building-the-home-lab-kubernetes-playground-part-6>здесь</a>.</p><p>Я добавил этот список, в котором представлены блоги, посвященные различным развертываемым кластерам Kubernetes.</p><ul><li><a href=https://vzilla.co.uk/vzilla-blog/building-the-home-lab-kubernetes-playground-part-1>Kubernetes playground – How to choose your platform</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/building-the-home-lab-kubernetes-playground-part-2>Kubernetes playground – Setting up your cluster</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/getting-started-with-amazon-elastic-kubernetes-service-amazon-eks>Getting started with Amazon Elastic Kubernetes Service (Amazon EKS)</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/getting-started-with-microsoft-azure-kubernetes-service-aks>Getting started with Microsoft Azure Kubernetes Service (AKS)</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/getting-started-with-microsoft-aks-azure-powershell-edition>Getting Started with Microsoft AKS – Azure PowerShell Edition</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/getting-started-with-google-kubernetes-service-gke>Getting started with Google Kubernetes Service (GKE)</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/kubernetes-how-to-aws-bottlerocket-amazon-eks>Kubernetes, How to – AWS Bottlerocket + Amazon EKS</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/getting-started-with-civo-cloud>Getting started with CIVO Cloud</a></li><li><a href=https://vzilla.co.uk/vzilla-blog/project_pace-kasten-k10-demo-environment-for-everyone>Minikube - Kubernetes Demo Environment For Everyone</a></li></ul><h2 id=ресурсы>Ресурсы</h2><ul><li><a href=https://kubernetes.io/docs/home/>Kubernetes Documentation</a></li><li><a href="https://www.youtube.com/watch?v=X48VuDVv0do">TechWorld with Nana - Kubernetes Tutorial for Beginners [FULL COURSE in 4 Hours]</a></li><li><a href="https://www.youtube.com/watch?v=s_o8dwzRlu4">TechWorld with Nana - Kubernetes Crash Course for Absolute Beginners</a></li><li><a href="https://www.youtube.com/watch?v=KVBON1lA9N8">Kunal Kushwaha - Kubernetes Tutorial for Beginners | What is Kubernetes? Architecture Simplified!</a></li></ul></article><div class=my-4><a href=https://romankurnovskii.com/ru/tags/devops/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-yalla">#devops</a></div><div class="-mx-2 mt-4 flex flex-col border-t border-b pb-1 px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">Ранее</span>
<a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day51/ class=block>51. Установка minikube</a></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">Далее</span>
<a href=https://romankurnovskii.com/ru/tracks/90daysofdevops/day53/ class=block>53. Обзор Rancher</a></div></div><div id=open_comments_block></div><script src=/opencomments.js renderdivid=open_comments_block server=https://eyt4njm3se.execute-api.eu-west-1.amazonaws.com/comments awstag defer></script></div><div class="hidden lg:block lg:w-1/4"><div class="bg-primary-bg prose sticky top-7 z-10 hidden
px-6 lg:block"><h3 class=text-lg>Содержание</h3></div><div class="sticky-toc hidden px-0 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#настройка-многоузлового-кластера-kubernetes>Настройка многоузлового кластера Kubernetes</a><ul><li><a href=#краткая-информация-о-vagrant>Краткая информация о Vagrant</a></li><li><a href=#лабораторная-среда-kubernetes>Лабораторная среда Kubernetes</a></li><li><a href=#vagrantfile-и-shell-script-walkthrough>Vagrantfile и Shell Script walkthrough</a></li><li><a href=#доступ-к-кластеру-kubernetes>Доступ к кластеру Kubernetes</a></li></ul></li><li><a href=#ресурсы>Ресурсы</a></li></ul></nav><div class="feedback-links mt-4 text-sm"><hr><div><a href=https://github.com/romankurnovskii/romankurnovskii.github.io/edit/main/content/tracks/90daysofdevops/day52.ru.md title="Edit this page" target=_blank><i class="fas fa-edit me-1"></i>
<span>Редактировать страницу</span></a></div><div><a href="https://github.com/romankurnovskii/romankurnovskii.github.io/issues/new/?body=File:%20[/content/tracks/90daysofdevops/day52.ru.md/]%28/https:/romankurnovskii.com/ru/tracks/90daysofdevops/day52/%29" title="Request issue" target=_blank><i class="fas fa-check me-1" aria-hidden=true></i>
<span>Запросить изменения</span></a></div></div></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div></div></div></div></div><script>document.addEventListener("DOMContentLoaded",()=>{changeSidebarHeight(),switchDocToc()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2023 <a href=https://romankurnovskii.com>Roman Kurnovskii</a> personal page
&#183;
<a href=https://romankurnovskii.com/ru/index.xml target=_blank>RSS</a> &#183;
<a href=https://gohugo.io>Hugo</a> &#183;
Updated <a href=https://github.com/romankurnovskii/romankurnovskii.github.io/commit/40d4080 target=_blank>2023-02-11</a></p></div><script src=/js/lunr.stemmer.support.min.js></script>
<script src=/js/lunr.ru.min.js></script>
<script src=/js/lunr.multi.min.js></script>
<script src=/js/search.js?v2 languagemode=ru></script><div id=search-result tabindex=-1 class="overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 max-w-xs" hidden><div class="relative p-4 w-full max-w-xs h-full md:h-auto"><div class="relative bg-white rounded-lg shadow dark:bg-gray-700"><div class=p-6><h3>Search results</h3><div id=popup_search_results class=prose></div></div></div></div></div><script src=/js/search-page.js?v3></script>
<script src=/js/base.js?7 languagemode=ru></script></div></footer><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js defer></script>
<script src=/js/zoom-image/placeholders.js?4 defer></script>
<script src=/js/zoom-image/index.js?4 defer></script></body></html>